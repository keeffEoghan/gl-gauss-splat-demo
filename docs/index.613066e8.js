!function(){let e;function n(e,n,t,r){Object.defineProperty(e,n,{get:t,set:r,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},o={},i={},a=r.parcelRequire94c2;null==a&&((a=function(e){if(e in o)return o[e].exports;if(e in i){var n=i[e];delete i[e];var t={id:e,exports:{}};return o[e]=t,n.call(t.exports,t,t.exports),t.exports}var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,n){i[e]=n},r.parcelRequire94c2=a);var l=a.register;l("4hU3w",function(e,t){n(e.exports,"register",function(){return r},function(e){return r=e});var r,o=new Map;r=function(e,n){for(var t=0;t<n.length-1;t+=2)o.set(n[t],{baseUrl:e,path:n[t+1]})}}),l("hkAy6",function(e,t){n(e.exports,"getBundleURL",function(){return r},function(e){return r=e}),n(e.exports,"getOrigin",function(){return o},function(e){return o=e});var r,o,i={};r=function(e){var n=i[e];return n||(n=function(){try{throw Error()}catch(n){var e=(""+n.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^)\n]+/g);if(e)return(""+e[2]).replace(/^((?:https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/.+)\/[^/]+$/,"$1")+"/"}return"/"}(),i[e]=n),n},o=function(e){var n=(""+e).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^/]+/);if(!n)throw Error("Origin not found");return n[0]}}),a("4hU3w").register(a("hkAy6").getBundleURL("6emNa"),JSON.parse('["6emNa","index.613066e8.js","hlVKh","worker.16797bd4.js"]'));let s=(e,n=e=>void 0!==e?": "+e:"")=>class extends Error{origMessage;constructor(t){super(e(t)+n(t)),this.origMessage=void 0!==t?String(t):""}},c=s(()=>"illegal arity"),f=e=>{throw new c(e)},d=(e,n)=>"function"==typeof e?.[n],v=e=>d(e,"xform")?e.xform():e,u=e=>"function"==typeof e?.[Symbol.iterator],x=(e,n)=>[e[0],e[1],n],m=Symbol(),p=()=>{},y=e=>e,h=e=>null!=e&&"function"!=typeof e&&void 0!==e.length;class g{value;constructor(e){this.value=e}deref(){return this.value}}let _=e=>new g(e),w=e=>e instanceof g,b=e=>e instanceof g?e:new g(e),z=e=>e instanceof g?e.deref():e,A=e=>2===e.length?[void 0,e[1]]:3===e.length?[e[1],e[2]]:f(e.length);function E(...e){let n=e[0],t=n[0],r=n[1],o=n[2],i=null==(e=A(e))[0]?t():e[0],a=e[1];return z(r(d(a,"$reduce")?a.$reduce(o,i):h(a)?S(o,i,a):L(o,i,a)))}let S=(e,n,t)=>{for(let r=0,o=t.length;r<o;r++)if(w(n=e(n,t[r]))){n=n.deref();break}return n},L=(e,n,t)=>{for(let r of t)if(w(n=e(n,r))){n=n.deref();break}return n},O=(e,n)=>[e,y,n];function*M(e,n){let t=v(e)([p,p,(e,n)=>n])[2];for(let e of n){let n=t(m,e);if(w(n)){(n=z(n.deref()))!==m&&(yield n);return}n!==m&&(yield n)}}let T=(e,n,t=M)=>{let r=n.length-1;return u(n[r])?n.length>1?t(e.apply(null,n.slice(0,r)),n[r]):t(e(),n[0]):void 0};function j(e,n){return u(n)?M(j(e),n):n=>{let t=n[2];return x(n,(n,r)=>t(n,e(r)))}}class k{from;to;step;constructor(e,n,t){void 0===e?(e=0,n=1/0):void 0===n&&(n=e,e=0),t=void 0===t?e<n?1:-1:t,this.from=e,this.to=n,this.step=t}*[Symbol.iterator](){let{from:e,to:n,step:t}=this;if(t>0)for(;e<n;)yield e,e+=t;else if(t<0)for(;e>n;)yield e,e+=t}$reduce(e,n){let t=this.step;if(t>0)for(let r=this.from,o=this.to;r<o&&!w(n);r+=t)n=e(n,r);else for(let r=this.from,o=this.to;r>o&&!w(n);r+=t)n=e(n,r);return n}}let D=(e,n,t)=>{let r,o;switch(t.length){case 4:o=t[3],r=t[2];break;case 3:o=t[2];break;case 2:return j(n=>e(t[0],t[1],n));default:f(t.length)}return n(v(t[0])(t[1]),r,o)};function*U(...e){let n=e.map(e=>e[Symbol.iterator]());for(;;){let e=[];for(let t of n){let n=t.next();if(n.done)return;e.push(n.value)}yield e}}let $=s(()=>"unsupported operation"),R=e=>{throw new $(e)},C=([e,n])=>`${e}*${n}`,F=e=>n=>n>1?`${e}[i${e}+${n}*s${e}]`:1==n?`${e}[i${e}+s${e}]`:`${e}[i${e}]`,N=e=>j(F(e),new k(void 0,void 0,void 0)),I=e=>j(n=>`${e}[${n}]`,new k(void 0,void 0,void 0)),P=(e,n,t,r="a",o="",i="",a="",l=!1)=>{var s;let c;return[i,function e(...n){return D(e,E,n)}(function(...e){return(function e(...n){let[t,r,o,i,a,l,s,c,d,v]=n;switch(n.length){case 0:f(0);case 1:return t;case 2:return(...e)=>t(r(...e));case 3:return(...e)=>t(r(o(...e)));case 4:return(...e)=>t(r(o(i(...e))));case 5:return(...e)=>t(r(o(i(a(...e)))));case 6:return(...e)=>t(r(o(i(a(l(...e))))));case 7:return(...e)=>t(r(o(i(a(l(s(...e)))))));case 8:return(...e)=>t(r(o(i(a(l(s(c(...e))))))));case 9:return(...e)=>t(r(o(i(a(l(s(c(d(...e)))))))));default:let u=(...e)=>t(r(o(i(a(l(s(c(d(v(...e))))))))));return 10===n.length?u:e(u,...n.slice(10))}}).apply(null,e=e.map(v))}(function e(n,t){return u(t)?function*(e,n){let t=v(e)(O(()=>[],(e,n)=>(e.push(n),e))),r=t[1],o=t[2];for(let e of n){let n=o([],e);if(w(n)){yield*z(r(n.deref()));return}n.length&&(yield*n)}yield*z(r([]))}(e(n),t):e=>{let t=e[2],r=n;return x(e,(e,n)=>--r>0?t(e,n):0===r?b(t(e,n)):_(e))}}(e),function e(...n){return T(e,n)||(e=>{let t=e[2],r=n[0],o=n[1]||0;return x(e,(e,n)=>t(e,r(o++,n)))})}((e,t)=>n(t,e))),(s=(s=o)||"",c=!0,O(()=>"",(e,n)=>(e=c?e+n:e+s+n,c=!1,e))),U.apply(null,t.split(",").map(l?N:I))),a,""!==r?`return ${r};`:""]},X=(e,n,t,r=t,o="a",i,a,l,s=!1)=>Function(t,P(e,n,r,o,i,a,l,s).join("")),V=e=>X(e,C,"o,a,io=0,ia=0,so=1,sa=1","o,a","","+","return ",";",!0),q=V(2),Y=V(3),H=V(4),K=(e,n,t)=>(e||(e=[]),e[0]=n,e[1]=t,e),B=(e,n,t,r)=>(e||(e=[]),e[0]=n,e[1]=t,e[2]=r,e),G=(e,n,t,r,o)=>(e||(e=[]),e[0]=n,e[1]=t,e[2]=r,e[3]=o,e),J=(e,...n)=>{if(!e)return n;for(let t=0,r=n.length;t<r;t++)e[t]=n[t];return e},W=((e=0)=>{let n;let t=[,,,,,],r=(...r)=>{let o=t[r[e].length]||n;return o?o(...r):R(`no impl for vec size ${r[e].length}`)};return r.add=(e,n)=>t[e]=n,r.default=e=>n=e,r.impl=e=>t[e]||n,r})(1);W.add(4,(e,n,t)=>K(e||t,q(n,t,0,0,2),q(n,t,1,0,2))),W.add(6,(e,n,t)=>K(e||t,q(n,t,0,0,2)+n[4],q(n,t,1,0,2)+n[5])),W.add(9,(e,n,t)=>B(e||t,Y(n,t,0,0,3),Y(n,t,1,0,3),Y(n,t,2,0,3))),W.add(16,(e,n,t)=>G(e||t,H(n,t,0,0,4),H(n,t,1,0,4),H(n,t,2,0,4),H(n,t,3,0,4)));let Q=(e,n,t)=>{let r=Y(n,t,3,0,4)+n[15];return 0!==r?B(e||t,(Y(n,t,0,0,4)+n[12])/r,(Y(n,t,1,0,4)+n[13])/r,(Y(n,t,2,0,4)+n[14])/r):void 0},Z=(e,n,t)=>{let{0:r,1:o,2:i,3:a}=n,{0:l,1:s,2:c,3:f}=t;return G(e||n,r*f+a*l+o*c-i*s,o*f+a*s+i*l-r*c,i*f+a*c+r*s-o*l,a*f-r*l-o*s-i*c)},ee=-1/0,en=1/0;Object.freeze([ee,ee]),Object.freeze([en,en]),Object.freeze([1,1]),Object.freeze([0,0]),Object.freeze([1,0]),Object.freeze([0,1]),Object.freeze([ee,ee,ee]),Object.freeze([en,en,en]),Object.freeze([1,1,1]);let et=Object.freeze([0,0,0]);Object.freeze([1,0,0]),Object.freeze([0,1,0]),Object.freeze([0,0,1]),Object.freeze([ee,ee,ee,ee]),Object.freeze([en,en,en,en]),Object.freeze([1,1,1,1]),Object.freeze([0,0,0,0]),Object.freeze([1,0,0,0]),Object.freeze([0,1,0,0]),Object.freeze([0,0,1,0]),Object.freeze([0,0,0,1]);let er=(e,n,t=et)=>{let[r,o,i,a]=n,l=r+r,s=o+o,c=i+i,f=r*l,d=r*s,v=r*c,u=o*s,x=o*c,m=i*c,p=a*l,y=a*s,h=a*c;return J(e||[],1-u-m,d+h,v-y,0,d-h,1-f-m,x+p,0,v+y,x-p,1-f-u,0,t[0],t[1],t[2],1)},eo=(e,n,t,r,o)=>(e||(e=[]),e[0]=n,e[1]=t,e[2]=r,e[3]=o,e),ei=(e,n=e=>void 0!==e?": "+e:"")=>class extends Error{origMessage;constructor(t){super(e(t)+n(t)),this.origMessage=void 0!==t?String(t):""}},ea=ei(()=>"illegal arity"),el=e=>{throw new ea(e)},es=(e,n)=>"function"==typeof e?.[n],ec=e=>es(e,"xform")?e.xform():e,ef=e=>"function"==typeof e?.[Symbol.iterator],ed=(e,n)=>[e[0],e[1],n],ev=Symbol(),eu=()=>{},ex=e=>e,em=e=>null!=e&&"function"!=typeof e&&void 0!==e.length;class ep{value;constructor(e){this.value=e}deref(){return this.value}}let ey=e=>new ep(e),eh=e=>e instanceof ep,eg=e=>e instanceof ep?e:new ep(e),e_=e=>e instanceof ep?e.deref():e,ew=e=>2===e.length?[void 0,e[1]]:3===e.length?[e[1],e[2]]:el(e.length);function eb(...e){let n=e[0],t=n[0],r=n[1],o=n[2],i=null==(e=ew(e))[0]?t():e[0],a=e[1];return e_(r(es(a,"$reduce")?a.$reduce(o,i):em(a)?ez(o,i,a):eA(o,i,a)))}let ez=(e,n,t)=>{for(let r=0,o=t.length;r<o;r++)if(eh(n=e(n,t[r]))){n=n.deref();break}return n},eA=(e,n,t)=>{for(let r of t)if(eh(n=e(n,r))){n=n.deref();break}return n},eE=(e,n)=>[e,ex,n];function*eS(e,n){let t=ec(e)([eu,eu,(e,n)=>n])[2];for(let e of n){let n=t(ev,e);if(eh(n)){(n=e_(n.deref()))!==ev&&(yield n);return}n!==ev&&(yield n)}}let eL=(e,n,t=eS)=>{let r=n.length-1;return ef(n[r])?n.length>1?t(e.apply(null,n.slice(0,r)),n[r]):t(e(),n[0]):void 0};function eO(e,n){return ef(n)?eS(eO(e),n):n=>{let t=n[2];return ed(n,(n,r)=>t(n,e(r)))}}class eM{from;to;step;constructor(e,n,t){void 0===e?(e=0,n=1/0):void 0===n&&(n=e,e=0),t=void 0===t?e<n?1:-1:t,this.from=e,this.to=n,this.step=t}*[Symbol.iterator](){let{from:e,to:n,step:t}=this;if(t>0)for(;e<n;)yield e,e+=t;else if(t<0)for(;e>n;)yield e,e+=t}$reduce(e,n){let t=this.step;if(t>0)for(let r=this.from,o=this.to;r<o&&!eh(n);r+=t)n=e(n,r);else for(let r=this.from,o=this.to;r>o&&!eh(n);r+=t)n=e(n,r);return n}}let eT=(e,n,t)=>{let r,o;switch(t.length){case 4:o=t[3],r=t[2];break;case 3:o=t[2];break;case 2:return eO(n=>e(t[0],t[1],n));default:el(t.length)}return n(ec(t[0])(t[1]),r,o)};function*ej(...e){let n=e.map(e=>e[Symbol.iterator]());for(;;){let e=[];for(let t of n){let n=t.next();if(n.done)return;e.push(n.value)}yield e}}let ek=ei(()=>"unsupported operation"),eD=e=>{throw new ek(e)},eU=(e=0)=>{let n;let t=[,,,,,],r=(...r)=>{let o=t[r[e].length]||n;return o?o(...r):eD(`no impl for vec size ${r[e].length}`)};return r.add=(e,n)=>t[e]=n,r.default=e=>n=e,r.impl=e=>t[e]||n,r},e$="o,a,b",eR="o,a,n",eC="io=0,ia=0,ib=0,so=1,sa=1,sb=1",eF="!o&&(o=a);",eN=e=>([n,t])=>`${n}=${t}${e}n;`,eI=e=>n=>n>1?`${e}[i${e}+${n}*s${e}]`:1==n?`${e}[i${e}+s${e}]`:`${e}[i${e}]`,eP=e=>eO(eI(e),new eM(void 0,void 0,void 0)),eX=e=>eO(n=>`${e}[${n}]`,new eM(void 0,void 0,void 0)),eV=(e,n,t,r="a",o="",i="",a="",l=!1)=>{var s;let c;return[i,function e(...n){return eT(e,eb,n)}(function(...e){return(function e(...n){let[t,r,o,i,a,l,s,c,f,d]=n;switch(n.length){case 0:el(0);case 1:return t;case 2:return(...e)=>t(r(...e));case 3:return(...e)=>t(r(o(...e)));case 4:return(...e)=>t(r(o(i(...e))));case 5:return(...e)=>t(r(o(i(a(...e)))));case 6:return(...e)=>t(r(o(i(a(l(...e))))));case 7:return(...e)=>t(r(o(i(a(l(s(...e)))))));case 8:return(...e)=>t(r(o(i(a(l(s(c(...e))))))));case 9:return(...e)=>t(r(o(i(a(l(s(c(f(...e)))))))));default:let v=(...e)=>t(r(o(i(a(l(s(c(f(d(...e))))))))));return 10===n.length?v:e(v,...n.slice(10))}}).apply(null,e=e.map(ec))}(function e(n,t){return ef(t)?function*(e,n){let t=ec(e)(eE(()=>[],(e,n)=>(e.push(n),e))),r=t[1],o=t[2];for(let e of n){let n=o([],e);if(eh(n)){yield*e_(r(n.deref()));return}n.length&&(yield*n)}yield*e_(r([]))}(e(n),t):e=>{let t=e[2],r=n;return ed(e,(e,n)=>--r>0?t(e,n):0===r?eg(t(e,n)):ey(e))}}(e),function e(...n){return eL(e,n)||(e=>{let t=e[2],r=n[0],o=n[1]||0;return ed(e,(e,n)=>t(e,r(o++,n)))})}((e,t)=>n(t,e))),(s=(s=o)||"",c=!0,eE(()=>"",(e,n)=>(e=c?e+n:e+s+n,c=!1,e))),ej.apply(null,t.split(",").map(l?eP:eX))),a,""!==r?`return ${r};`:""]},eq=(e,n,t="a",r,o,i=!1)=>[r,"for(let i=a.length;--i>=0;) {",e(n.split(",").map(i?e=>`${e}[i${e}+i*s${e}]`:e=>`${e}[i]`)),"}",o,null!==t?`return ${t};`:""],eY=(e,n=e$,t="o",r=eF,o)=>[r,"while(k--\x3e0) {",e(n.split(",").map(e=>`${e}[i${e}+k*s${e}]`)),"}",o,null!==t?`return ${t};`:""],eH=(e,n)=>`!${e} && (${e}=${n.split(",")[1]});`,eK=(e,n,t,r=t,o="a",i,a,l,s=!1)=>Function(t,eV(e,n,r,o,i,a,l,s).join("")),eB=(e,n,t=n,r="a",o,i,a=!1)=>Function(n,eq(e,t,r,o,i,a).join("")),eG=(e,n,t=n,r,o,i)=>Function(n,eY(e,t,r,o,i).join("")),eJ=(e,n=e$,t,r="o",o=1,i)=>{t=t||n,i=null!=i?i:eH(r,t);let a=eU(o),l=o=>a.add(o,eK(o,e,n,t,r,"",i));return a.default(eB(e,n,t,r,i)),[a,l(2),l(3),l(4)]},eW=e=>eJ(eN(e),eR),[eQ,eZ,e0,e1]=eJ(([e,n,t])=>`${e}=${n}*${t};`),[e2,e3,e4,e5]=eW("*"),[e9,e8,e6,e7]=((e,n=e$,t=eC,r=e$,o="o",i,a=[2,3,4])=>[eG(e,`${n},k,${t}`,r,o,void 0),...a.map(i=>eK(i,e,`${n},${t}`,r,o,"",eH(o,r),"",!0))])(eN("*"),eR,"io=0,ia=0,so=1,sa=1","o,a"),[ne,nn,nt,nr]=eW("+"),no=e=>ni.add(e,eK(e,([e])=>`${e}*${e}`,"a","a","","+","return ",";")),ni=eU();ni.default(eB(([e])=>`sum+=${e}*${e};`,"a",void 0,"sum","let sum=0;")),no(2);let na=no(3),nl=no(4),[ns,nc,nf,nd]=eJ(([e,n])=>`${e}=${n};`,"o,a",void 0,"o",1,"!o&&(o=[]);"),nv=(e,n,t=1)=>{e||(e=n);let r=Math.sqrt(na(n));return r>=1e-6?e4(e,n,t/r):e!==n?nf(e,n):e},nu=(e,n,t=1)=>{e||(e=n);let r=Math.sqrt(nl(n));return r>=1e-6?e5(e,n,t/r):e!==n?nd(e,n):e},nx=(e,n)=>(e%n+n)%n,nm=-1/0,np=1/0;Object.freeze([nm,nm]),Object.freeze([np,np]),Object.freeze([1,1]),Object.freeze([0,0]),Object.freeze([1,0]),Object.freeze([0,1]),Object.freeze([nm,nm,nm]),Object.freeze([np,np,np]),Object.freeze([1,1,1]),Object.freeze([0,0,0]);let ny=Object.freeze([1,0,0]),nh=Object.freeze([0,1,0]),ng=Object.freeze([0,0,1]);Object.freeze([nm,nm,nm,nm]),Object.freeze([np,np,np,np]),Object.freeze([1,1,1,1]),Object.freeze([0,0,0,0]),Object.freeze([1,0,0,0]),Object.freeze([0,1,0,0]),Object.freeze([0,0,1,0]),Object.freeze([0,0,0,1]);let{sin:n_,cos:nw}=Math,nb={xyz:[ny,nh,ng],yxz:[nh,ny,ng],xzy:[ny,ng,nh],zxy:[ng,ny,nh],yzx:[nh,ng,ny],zyx:[ng,nh,ny]};function nz(e,n,t=0){return(e||(e=[]))[3]=nw(t*=.5),nv(e,n,n_(t))}var nA={};nA="precision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\nuniform vec2 viewport;\nuniform mat4 projection;\nuniform mat4 view;\nuniform vec2 focal;\nuniform highp usampler2D texture;\n\n#if defined(maskLocal) && !defined(maskCenter)\n  uniform mat4 viewProjectionInverse;\n#endif\n\n#ifndef maskFrag\n  uniform float splits;\n  uniform float time;\n  uniform float dt;\n  uniform float offsets;\n  uniform vec3 velocity;\n  uniform float speed;\n  uniform float fade;\n  uniform float scale;\n  uniform vec3 curve;\n  uniform float slide;\n#endif\n\nin vec2 position;\nin int index;\n\n#ifdef maskFrag\n  out vec3 vAt;\n  out float vMeta;\n#else\n  out float vMask;\n#endif\n\nout vec4 vColor;\nout vec2 vPosition;\n\nfloat when_eq_1540259130(float x, float y) {\n  return 1.0 - abs(sign(x - y));\n}\n\nvec2 when_eq_1540259130(vec2 x, vec2 y) {\n  return 1.0 - abs(sign(x - y));\n}\n\nvec3 when_eq_1540259130(vec3 x, vec3 y) {\n  return 1.0 - abs(sign(x - y));\n}\n\nvec4 when_eq_1540259130(vec4 x, vec4 y) {\n  return 1.0 - abs(sign(x - y));\n}\n\n#ifndef maskFrag\n  //\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute(vec4 x) {\n     return mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat snoise(vec3 v)\n  {\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min( g.xyz, l.zxy );\n  vec3 i2 = max( g.xyz, l.zxy );\n\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod289(i);\n  vec4 p = permute( permute( permute(\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3  ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n  }\n\nvec3 snoiseVec3( vec3 x ){\n\n  float s  = snoise(vec3( x ));\n  float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n  float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n  vec3 c = vec3( s , s1 , s2 );\n  return c;\n\n}\n\nvec3 curlNoise( vec3 p ){\n  \n  const float e = .1;\n  vec3 dx = vec3( e   , 0.0 , 0.0 );\n  vec3 dy = vec3( 0.0 , e   , 0.0 );\n  vec3 dz = vec3( 0.0 , 0.0 , e   );\n\n  vec3 p_x0 = snoiseVec3( p - dx );\n  vec3 p_x1 = snoiseVec3( p + dx );\n  vec3 p_y0 = snoiseVec3( p - dy );\n  vec3 p_y1 = snoiseVec3( p + dy );\n  vec3 p_z0 = snoiseVec3( p - dz );\n  vec3 p_z1 = snoiseVec3( p + dz );\n\n  float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n  float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n  float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n\n  const float divisor = 1.0 / ( 2.0 * e );\n  return normalize( vec3( x , y , z ) * divisor );\n\n}\n\nfloat range(float vmin, float vmax, float value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\nvec2 range(vec2 vmin, vec2 vmax, vec2 value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\nvec3 range(vec3 vmin, vec3 vmax, vec3 value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\nvec4 range(vec4 vmin, vec4 vmax, vec4 value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\nfloat when_gt_529295689(float x, float y) {\n  return max(sign(x - y), 0.0);\n}\n\nvec2 when_gt_529295689(vec2 x, vec2 y) {\n  return max(sign(x - y), 0.0);\n}\n\nvec3 when_gt_529295689(vec3 x, vec3 y) {\n  return max(sign(x - y), 0.0);\n}\n\nvec4 when_gt_529295689(vec4 x, vec4 y) {\n  return max(sign(x - y), 0.0);\n}\n\nfloat when_le_2315452051(float x, float y) {\n  return 1.0 - when_gt_529295689(x, y);\n}\n\nvec2 when_le_2315452051(vec2 x, vec2 y) {\n  return 1.0 - when_gt_529295689(x, y);\n}\n\nvec3 when_le_2315452051(vec3 x, vec3 y) {\n  return 1.0 - when_gt_529295689(x, y);\n}\n\nvec4 when_le_2315452051(vec4 x, vec4 y) {\n  return 1.0 - when_gt_529295689(x, y);\n}\n\nfloat when_lt_2281831123(float x, float y) {\n  return max(sign(y - x), 0.0);\n}\n\nvec2 when_lt_2281831123(vec2 x, vec2 y) {\n  return max(sign(y - x), 0.0);\n}\n\nvec3 when_lt_2281831123(vec3 x, vec3 y) {\n  return max(sign(y - x), 0.0);\n}\n\nvec4 when_lt_2281831123(vec4 x, vec4 y) {\n  return max(sign(y - x), 0.0);\n}\n\nfloat flow(vec3 at,\n    float split, float splits,\n    float time, float dt, float offsets, vec3 velocity, float speed,\n    float fade, float scale, vec3 curve, float slide) {\n  at += time*velocity;\n\n  float to;\n  // float to = simplexNoise(at*scale);\n\n  for(float i = 0.0; i < offsets; ++i) {\n    at += curlNoise(at)*speed;\n    // at += curlNoise(at)*speed*(time*velocity);\n    // at += curlNoise(at+(dt*velocity))*speed;\n    // at += curlNoise(at+(time*velocity))*speed;\n    // to = mix(to, simplexNoise(at*scale), fade);\n  }\n\n  to = range(-1.0, 1.0, snoise(at*scale));\n  to = (clamp((pow(to, curve.x)*curve.y)+curve.z, 0.0, 1.0)*splits)+slide;\n\n  // return le(split, to)*lt(to, split+1.0);\n  return min(1.0,\n    (when_le_2315452051(split, to)*when_lt_2281831123(to, split+1.0))+\n      (when_le_2315452051(split, 0.0)*when_le_2315452051(to, 0.0))+\n      (when_le_2315452051(splits, split+1.0)*when_le_2315452051(splits, to)));\n}\n\n#endif\n\nconst vec4 none = vec4(0.0, 0.0, 2.0, 1.0);\n\nvoid main() {\n  uvec4 data = texelFetch(texture,\n    ivec2((uint(index)&0x3ffu) << 1, uint(index) >> 10), 0);\n\n  vec4 atData = uintBitsToFloat(data);\n  vec3 at = atData.xyz;\n  float meta = atData.w;\n  vec4 atView = view*vec4(at, 1);\n  vec4 atScreen = projection*atView;\n  float clip = 1.2*atScreen.w;\n\n  bool clipped = (atScreen.z < -clip) || (atScreen.x < -clip) ||\n    (atScreen.x > clip) || (atScreen.y < -clip) || (atScreen.y > clip);\n\n  if(clipped) {\n    gl_Position = none;\n\n    return;\n  }\n\n  uvec4 cov = texelFetch(texture,\n    ivec2(((uint(index)&0x3ffu) << 1) | 1u, uint(index) >> 10), 0);\n\n  vec2 u1 = unpackHalf2x16(cov.x);\n  vec2 u2 = unpackHalf2x16(cov.y);\n  vec2 u3 = unpackHalf2x16(cov.z);\n  mat3 Vrk = mat3(u1.x, u1.y, u2.x, u1.y, u2.y, u3.x, u2.x, u3.x, u3.y);\n\n  mat3 J = mat3(focal.x/atView.z, 0.0, -(focal.x*atView.x)/(atView.z*atView.z),\n    0.0, -focal.y/atView.z, (focal.y*atView.y)/(atView.z*atView.z),\n    0.0, 0.0, 0.0);\n\n  mat3 T = transpose(mat3(view))*J;\n  mat3 cov2d = transpose(T)*Vrk*T;\n  float mid = (cov2d[0][0]+cov2d[1][1])/2.0;\n  float radius = length(vec2((cov2d[0][0]-cov2d[1][1])/2.0, cov2d[0][1]));\n  float lambda1 = mid+radius;\n  float lambda2 = mid-radius;\n\n  if(lambda2 < 0.0) {\n    gl_Position = none;\n\n    return;\n  }\n\n  vec2 diagonal = normalize(vec2(cov2d[0][1], lambda1-cov2d[0][0]));\n  vec2 majorAxis = min(sqrt(2.0*lambda1), 1024.0)*diagonal;\n  vec2 minorAxis = min(sqrt(2.0*lambda2), 1024.0)*vec2(diagonal.y, -diagonal.x);\n  vec3 atSplat = (atScreen.xyz /= atScreen.w);\n\n  vec2 axes =\n    ((position.x*majorAxis)/viewport)+((position.y*minorAxis)/viewport);\n\n  atSplat.xy += axes;\n\n  uint rgba = cov.w;\n\n  vec4 color =\n    vec4(rgba&0xffu, (rgba >> 8)&0xffu, (rgba >> 16)&0xffu, (rgba >> 24)&0xffu);\n\n  vColor = (clamp(atSplat.z+1.0, 0.0, 1.0)*color)/255.0;\n\n  // vColor.r *= eq(meta, 0.0);\n  // vColor.g *= eq(meta, 1.0);\n  // vColor.b *= eq(meta, 2.0);\n\n  vPosition = position;\n\n  #if defined(maskLocal) && defined(maskCenter)\n    vec3 atMask = at;\n  #elif defined(maskLocal) && !defined(maskCenter)\n    vec3 atMask = vec3(viewProjectionInverse*vec4(atSplat, 1));\n  #elif defined(maskCenter)\n    vec3 atMask = atScreen.xyz;\n  #else\n    vec3 atMask = atSplat;\n  #endif\n\n  #ifdef maskFrag\n    vAt = atMask;\n    vMeta = meta;\n  #else\n    vMask = flow(atMask, meta, splits, time, dt, offsets, velocity, speed,\n      fade, scale, curve, slide);\n  #endif\n\n  gl_Position = vec4(atSplat.xy, 0, 1);\n}\n";var nE={};nE="precision highp float;\n#define GLSLIFY 1\n\n#define modeDiff 1\n#define modeGauss 2\n\n#ifdef maskFrag\n  uniform float splits;\n  uniform float time;\n  uniform float dt;\n  uniform float offsets;\n  uniform vec3 velocity;\n  uniform float speed;\n  uniform float fade;\n  uniform float scale;\n  uniform vec3 curve;\n  uniform float slide;\n#endif\n\n#if (maskMode == modeDiff) || (maskMode == modeGauss)\n  uniform float spread;\n#endif\n\n#ifdef maskFrag\n  in vec3 vAt;\n  in float vMeta;\n#else\n  in float vMask;\n#endif\n\nin vec4 vColor;\nin vec2 vPosition;\n\nout vec4 fragColor;\n\nfloat when_eq_1540259130(float x, float y) {\n  return 1.0 - abs(sign(x - y));\n}\n\nvec2 when_eq_1540259130(vec2 x, vec2 y) {\n  return 1.0 - abs(sign(x - y));\n}\n\nvec3 when_eq_1540259130(vec3 x, vec3 y) {\n  return 1.0 - abs(sign(x - y));\n}\n\nvec4 when_eq_1540259130(vec4 x, vec4 y) {\n  return 1.0 - abs(sign(x - y));\n}\n\n#ifdef maskFrag\n  //\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute(vec4 x) {\n     return mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat snoise(vec3 v)\n  {\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min( g.xyz, l.zxy );\n  vec3 i2 = max( g.xyz, l.zxy );\n\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod289(i);\n  vec4 p = permute( permute( permute(\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3  ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n  }\n\nvec3 snoiseVec3( vec3 x ){\n\n  float s  = snoise(vec3( x ));\n  float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n  float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n  vec3 c = vec3( s , s1 , s2 );\n  return c;\n\n}\n\nvec3 curlNoise( vec3 p ){\n  \n  const float e = .1;\n  vec3 dx = vec3( e   , 0.0 , 0.0 );\n  vec3 dy = vec3( 0.0 , e   , 0.0 );\n  vec3 dz = vec3( 0.0 , 0.0 , e   );\n\n  vec3 p_x0 = snoiseVec3( p - dx );\n  vec3 p_x1 = snoiseVec3( p + dx );\n  vec3 p_y0 = snoiseVec3( p - dy );\n  vec3 p_y1 = snoiseVec3( p + dy );\n  vec3 p_z0 = snoiseVec3( p - dz );\n  vec3 p_z1 = snoiseVec3( p + dz );\n\n  float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n  float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n  float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n\n  const float divisor = 1.0 / ( 2.0 * e );\n  return normalize( vec3( x , y , z ) * divisor );\n\n}\n\nfloat range(float vmin, float vmax, float value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\nvec2 range(vec2 vmin, vec2 vmax, vec2 value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\nvec3 range(vec3 vmin, vec3 vmax, vec3 value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\nvec4 range(vec4 vmin, vec4 vmax, vec4 value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\nfloat when_gt_529295689(float x, float y) {\n  return max(sign(x - y), 0.0);\n}\n\nvec2 when_gt_529295689(vec2 x, vec2 y) {\n  return max(sign(x - y), 0.0);\n}\n\nvec3 when_gt_529295689(vec3 x, vec3 y) {\n  return max(sign(x - y), 0.0);\n}\n\nvec4 when_gt_529295689(vec4 x, vec4 y) {\n  return max(sign(x - y), 0.0);\n}\n\nfloat when_le_2315452051(float x, float y) {\n  return 1.0 - when_gt_529295689(x, y);\n}\n\nvec2 when_le_2315452051(vec2 x, vec2 y) {\n  return 1.0 - when_gt_529295689(x, y);\n}\n\nvec3 when_le_2315452051(vec3 x, vec3 y) {\n  return 1.0 - when_gt_529295689(x, y);\n}\n\nvec4 when_le_2315452051(vec4 x, vec4 y) {\n  return 1.0 - when_gt_529295689(x, y);\n}\n\nfloat when_lt_2281831123(float x, float y) {\n  return max(sign(y - x), 0.0);\n}\n\nvec2 when_lt_2281831123(vec2 x, vec2 y) {\n  return max(sign(y - x), 0.0);\n}\n\nvec3 when_lt_2281831123(vec3 x, vec3 y) {\n  return max(sign(y - x), 0.0);\n}\n\nvec4 when_lt_2281831123(vec4 x, vec4 y) {\n  return max(sign(y - x), 0.0);\n}\n\nfloat flow(vec3 at,\n    float split, float splits,\n    float time, float dt, float offsets, vec3 velocity, float speed,\n    float fade, float scale, vec3 curve, float slide) {\n  at += time*velocity;\n\n  float to;\n  // float to = simplexNoise(at*scale);\n\n  for(float i = 0.0; i < offsets; ++i) {\n    at += curlNoise(at)*speed;\n    // at += curlNoise(at)*speed*(time*velocity);\n    // at += curlNoise(at+(dt*velocity))*speed;\n    // at += curlNoise(at+(time*velocity))*speed;\n    // to = mix(to, simplexNoise(at*scale), fade);\n  }\n\n  to = range(-1.0, 1.0, snoise(at*scale));\n  to = (clamp((pow(to, curve.x)*curve.y)+curve.z, 0.0, 1.0)*splits)+slide;\n\n  // return le(split, to)*lt(to, split+1.0);\n  return min(1.0,\n    (when_le_2315452051(split, to)*when_lt_2281831123(to, split+1.0))+\n      (when_le_2315452051(split, 0.0)*when_le_2315452051(to, 0.0))+\n      (when_le_2315452051(splits, split+1.0)*when_le_2315452051(splits, to)));\n}\n\n#endif\n\nvoid main() {\n  float d2 = dot(vPosition, vPosition);\n\n  if(d2 > 4.0) { discard; }\n\n  #ifdef maskFrag\n    float mask = flow(vAt, vMeta, splits, time, dt, offsets, velocity, speed,\n      fade, scale, curve, slide);\n  #else\n    float mask = vMask;\n  #endif\n\n  float a = exp(-d2);\n  vec4 color = vColor;\n\n  #if maskMode == modeDiff\n    a -= clamp(1.0-mask-spread, 0.0, 1.0);\n  #elif maskMode == modeGauss\n    mask = 1.0-mask;\n    a *= exp(-(mask*mask)/spread);\n    // a = exp(-(d2-(mask*mask)));\n  #else\n    a *= mask;\n  #endif\n\n  color.rgb *= (color.a *= a);\n\n  fragColor = color;\n}\n";let nS=[{id:0,img_name:"00001",width:1959,height:1090,position:[-3.0089893469241797,-.11086489695181866,-3.7527640949141428],rotation:[[.876134201218856,.06925962026449776,.47706599800804744],[-.04747421839895102,.9972110940209488,-.057586739349882114],[-.4797239414934443,.027805376500959853,.8769787916452908]],fy:1164.6601287484507,fx:1159.5880733038064},{id:1,img_name:"00009",width:1959,height:1090,position:[-2.5199776022057296,-.09704735754873686,-3.6247725540304545],rotation:[[.9982731285632193,-.011928707708098955,-.05751927260507243],[.0065061360949636325,.9955928229282383,-.09355533724430458],[.058381769258182864,.09301955098900708,.9939511719154457]],fy:1164.6601287484507,fx:1159.5880733038064},{id:2,img_name:"00017",width:1959,height:1090,position:[-.7737533667465242,-.3364271945329695,-2.9358969417573753],rotation:[[.9998813418672372,.013742375651625236,-.0069605529394208224],[-.014268370388586709,.996512943252834,-.08220929105659476],[.00580653013657589,.08229885200307129,.9965907801935302]],fy:1164.6601287484507,fx:1159.5880733038064},{id:3,img_name:"00025",width:1959,height:1090,position:[1.2198221749590001,-.2196687861401182,-2.3183162007028453],rotation:[[.9208648867765482,.0012010625395201253,.389880004297208],[-.06298204172269357,.987319521752825,.14571693239364383],[-.3847611242348369,-.1587410451475895,.9092635249821667]],fy:1164.6601287484507,fx:1159.5880733038064},{id:4,img_name:"00033",width:1959,height:1090,position:[1.742387858893817,-.13848225198886954,-2.0566370113193146],rotation:[[.24669889292141334,-.08370189346592856,-.9654706879349405],[.11343747891376445,.9919082664242816,-.05700815184573074],[.9624300466054861,-.09545671285663988,.2541976029815521]],fy:1164.6601287484507,fx:1159.5880733038064},{id:5,img_name:"00041",width:1959,height:1090,position:[3.6567309419223935,-.16470990600750707,-1.3458085590422042],rotation:[[.2341293058324528,-.02968330457755884,-.9717522161434825],[.10270823606832301,.99469554638321,-.005638106875665722],[.9667649592295676,-.09848690996657204,.2359360976431732]],fy:1164.6601287484507,fx:1159.5880733038064},{id:6,img_name:"00049",width:1959,height:1090,position:[3.9013554243203497,-.2597500978038105,-.8106154188297828],rotation:[[.6717235545638952,-.015718162115524837,-.7406351366386528],[.055627354673906296,.9980224478387622,.029270992841185218],[.7387104058127439,-.060861588786650656,.6712695459756353]],fy:1164.6601287484507,fx:1159.5880733038064},{id:7,img_name:"00057",width:1959,height:1090,position:[4.742994605467533,-.05591660945412069,.9500365976084458],rotation:[[-.17042655709210375,.01207080756938,-.9852964448542146],[.1165090336695526,.9931575292530063,-.00798543433078162],[.9784581921120181,-.1161568667478904,-.1706667764862097]],fy:1164.6601287484507,fx:1159.5880733038064},{id:8,img_name:"00065",width:1959,height:1090,position:[4.34676307626522,.08168160516967145,1.0876221470355405],rotation:[[-.003575447631888379,-.044792503246552894,-.9989899137764799],[.10770152645126597,.9931680875192705,-.04491693593046672],[.9941768441149182,-.10775333677534978,.0012732004866391048]],fy:1164.6601287484507,fx:1159.5880733038064},{id:9,img_name:"00073",width:1959,height:1090,position:[3.264984351114202,.078974937336732,1.0117200284114904],rotation:[[-.026919994628162257,-.1565891128261527,-.9872968974090509],[.08444552208239385,.983768234577625,-.1583319754069128],[.9960643893290491,-.0876350978794554,-.013259786205163005]],fy:1164.6601287484507,fx:1159.5880733038064}],nL=nS[0];function nO(e,n,t,r){return[2*e/t,0,0,0,0,-(2*n)/r,0,0,0,0,200/199.8,1,0,0,-.20020020020020018,0]}function nM(e){let n=e.rotation.flat(),t=e.position;return[n[0],n[1],n[2],0,n[3],n[4],n[5],0,n[6],n[7],n[8],0,-t[0]*n[0]-t[1]*n[3]-t[2]*n[6],-t[0]*n[1]-t[1]*n[4]-t[2]*n[7],-t[0]*n[2]-t[1]*n[5]-t[2]*n[8],1]}let nT=(e,n)=>[n[0]*e[0]+n[1]*e[4]+n[2]*e[8]+n[3]*e[12],n[0]*e[1]+n[1]*e[5]+n[2]*e[9]+n[3]*e[13],n[0]*e[2]+n[1]*e[6]+n[2]*e[10]+n[3]*e[14],n[0]*e[3]+n[1]*e[7]+n[2]*e[11]+n[3]*e[15],n[4]*e[0]+n[5]*e[4]+n[6]*e[8]+n[7]*e[12],n[4]*e[1]+n[5]*e[5]+n[6]*e[9]+n[7]*e[13],n[4]*e[2]+n[5]*e[6]+n[6]*e[10]+n[7]*e[14],n[4]*e[3]+n[5]*e[7]+n[6]*e[11]+n[7]*e[15],n[8]*e[0]+n[9]*e[4]+n[10]*e[8]+n[11]*e[12],n[8]*e[1]+n[9]*e[5]+n[10]*e[9]+n[11]*e[13],n[8]*e[2]+n[9]*e[6]+n[10]*e[10]+n[11]*e[14],n[8]*e[3]+n[9]*e[7]+n[10]*e[11]+n[11]*e[15],n[12]*e[0]+n[13]*e[4]+n[14]*e[8]+n[15]*e[12],n[12]*e[1]+n[13]*e[5]+n[14]*e[9]+n[15]*e[13],n[12]*e[2]+n[13]*e[6]+n[14]*e[10]+n[15]*e[14],n[12]*e[3]+n[13]*e[7]+n[14]*e[11]+n[15]*e[15]];function nj(e){let n=e[0]*e[5]-e[1]*e[4],t=e[0]*e[6]-e[2]*e[4],r=e[0]*e[7]-e[3]*e[4],o=e[1]*e[6]-e[2]*e[5],i=e[1]*e[7]-e[3]*e[5],a=e[2]*e[7]-e[3]*e[6],l=e[8]*e[13]-e[9]*e[12],s=e[8]*e[14]-e[10]*e[12],c=e[8]*e[15]-e[11]*e[12],f=e[9]*e[14]-e[10]*e[13],d=e[9]*e[15]-e[11]*e[13],v=e[10]*e[15]-e[11]*e[14],u=n*v-t*d+r*f+o*c-i*s+a*l;return u?[(e[5]*v-e[6]*d+e[7]*f)/u,(e[2]*d-e[1]*v-e[3]*f)/u,(e[13]*a-e[14]*i+e[15]*o)/u,(e[10]*i-e[9]*a-e[11]*o)/u,(e[6]*c-e[4]*v-e[7]*s)/u,(e[0]*v-e[2]*c+e[3]*s)/u,(e[14]*r-e[12]*a-e[15]*t)/u,(e[8]*a-e[10]*r+e[11]*t)/u,(e[4]*d-e[5]*c+e[7]*l)/u,(e[1]*c-e[0]*d-e[3]*l)/u,(e[12]*i-e[13]*r+e[15]*n)/u,(e[9]*r-e[8]*i-e[11]*n)/u,(e[5]*s-e[4]*f-e[6]*l)/u,(e[0]*f-e[1]*s+e[2]*l)/u,(e[13]*t-e[12]*o-e[14]*n)/u,(e[8]*o-e[9]*t+e[10]*n)/u]:null}function nk(e,n,t,r,o){let i=Math.hypot(t,r,o),a=Math.sin(n),l=Math.cos(n),s=1-l,c=(t/=i)*t*s+l,f=(r/=i)*t*s+(o/=i)*a,d=o*t*s-r*a,v=t*r*s-o*a,u=r*r*s+l,x=o*r*s+t*a,m=t*o*s+r*a,p=r*o*s-t*a,y=o*o*s+l;return[e[0]*c+e[4]*f+e[8]*d,e[1]*c+e[5]*f+e[9]*d,e[2]*c+e[6]*f+e[10]*d,e[3]*c+e[7]*f+e[11]*d,e[0]*v+e[4]*u+e[8]*x,e[1]*v+e[5]*u+e[9]*x,e[2]*v+e[6]*u+e[10]*x,e[3]*v+e[7]*u+e[11]*x,e[0]*m+e[4]*p+e[8]*y,e[1]*m+e[5]*p+e[9]*y,e[2]*m+e[6]*p+e[10]*y,e[3]*m+e[7]*p+e[11]*y,...e.slice(12,16)]}let nD=(e,n,t,r)=>[...e.slice(0,12),e[0]*n+e[4]*t+e[8]*r+e[12],e[1]*n+e[5]*t+e[9]*r+e[13],e[2]*n+e[6]*t+e[10]*r+e[14],e[3]*n+e[7]*t+e[11]*r+e[15]],nU=[-1,.02,.07,0,.02,1,-.1,0,-.07,-.1,-.99,0,-.01,-.16,2.91,1],n$=document.documentElement,nR=n$.querySelector("canvas"),nC=n$.querySelector(".progress"),nF=n$.querySelector(".spinner"),nN=n$.querySelector(".fps"),nI=n$.querySelector(".cam"),nP=new URLSearchParams(location.search),nX=nP.get("background");nX&&(n$.style.background=nX);let nV=nU;var nq={},nY={};nY=function(e,n,t){if(n===self.location.origin)return e;var r=t?"import "+JSON.stringify(e)+";":"importScripts("+JSON.stringify(e)+");";return URL.createObjectURL(new Blob([r],{type:"application/javascript"}))};var nH=a("hkAy6");let nK=nH.getBundleURL("6emNa")+"worker.16797bd4.js";async function nB(){let n,r,o,i,a,l,s,c,f,d,v="true"===nP.get("carousel");try{nV=JSON.parse(decodeURIComponent(location.hash.slice(1))),v=!1}catch(e){}let u=new Worker(nq),x=!1,m=1,p=[],y=[],h=Object.assign(["epok.splat"],nP.getAll("m-url")).map(e=>new URL(e,location.href)),g=parseFloat(nP.get("models-on")||h.length,10),_=parseFloat(nP.get("models-at")||0,10),w=parseFloat(nP.get("models-loop")||1e-4,10),b=self.state={spread:parseFloat(nP.get("s-spread")||.01,10),offsets:parseFloat(nP.get("s-offsets")||4,10),velocity:JSON.parse(nP.get("s-velocity")||"[0, 1e-4, 0]"),speed:parseFloat(nP.get("s-speed")||.2,10),fade:parseFloat(nP.get("s-fade")||.6,10),scale:parseFloat(nP.get("s-scale")||1,10),curve:JSON.parse(nP.get("s-curve")||"[1, 1, 0]"),slide:parseFloat(nP.get("s-slide")||0,10)},z=new Uint8Array(0),A=(t,i=0)=>{let a=(p.indexOf(t)+1||p.push(t))-1,{data:l,size:s,translation:c=t.translation=[0,0,0],rotation:f=t.rotation=[0,0,0],scale:d=t.scale=[1,1,1]}=t;if(!l)return t.size=t.count=0,a;let v=c?.some(e=>e)||d?.some(e=>e&&1!==e)||f?.some(e=>e),{length:u,buffer:x}=l,m=t.count=Math.floor((s??u)/32);if(t.size=32*m,v){let[t,a,l]=f,[s,v,u]=d;!function(n,t="zyx",r,o,i){let[a,l,s]=nb[t];Z(n,Z(n,nz(n,a,r),nz(e??=[],l,o)),nz(e,s,i))}(r??=[],"zyx",l,a,t),er(n??=[],r,c),e7(n,e7(n,e7(n,n,s),v,4,4),u,8,8);for(let e=Math.floor(i/32);e<m;++e){let t=32*e;t+=4*Q(null,n,new Float32Array(x,t,3)).length,t+=4*e0(null,new Float32Array(x,t,3),d).length;let i=new Uint8ClampedArray(x,t,4),[a,l,s,c]=i;e5(o,nr(o,eo(o??=[],l,s,c,a),-128),.0078125),Z(o,r,o),[l,s,c,a]=nr(o,nu(o,o,128),128),eo(i,a,l,s,c)}}return a},E=e=>u.postMessage({meta:y,buffer:z.buffer,vertexCount:Math.floor(z.length/32),freshData:e});function S(e,n,t){!function(e,n){y.fill(null,0,e).length=e;let t=p.length,r=y.reduce((e,r,o)=>e+((y[o]=p.at((n+o)%t))?.size??0),0);z.length!==r&&(z=new Uint8Array(r)),y.reduce((e,n)=>{let t=n?.data;if(!t)return e;let r=n.size,{length:o,buffer:i}=t;return z.set(r<o?new Uint8Array(i,0,r):t,e),e+r},0)}(e,n),E(t)}let L=nR.getContext("webgl2",{antialias:!1}),O=L.createShader(L.VERTEX_SHADER),M=`#version 300 es
#define maskMode ${nP.get("s-mode")||0}
`+("true"===nP.get("s-frag")?"#define maskFrag\n":"")+("false"!==nP.get("s-local")?"#define maskLocal\n":"")+("true"===nP.get("s-center")?"#define maskCenter\n":""),T=M+t(nA);L.shaderSource(O,T),L.compileShader(O),L.getShaderParameter(O,L.COMPILE_STATUS)||console.error(L.getShaderInfoLog(O),T);let j=L.createShader(L.FRAGMENT_SHADER),k=M+t(nE);L.shaderSource(j,k),L.compileShader(j),L.getShaderParameter(j,L.COMPILE_STATUS)||console.error(L.getShaderInfoLog(j),k);let D=L.createProgram();L.attachShader(D,O),L.attachShader(D,j),L.linkProgram(D),L.useProgram(D),L.getProgramParameter(D,L.LINK_STATUS)||console.error(L.getProgramInfoLog(D)),L.disable(L.DEPTH_TEST),L.enable(L.BLEND),L.blendFuncSeparate(L.ONE_MINUS_DST_ALPHA,L.ONE,L.ONE_MINUS_DST_ALPHA,L.ONE),L.blendEquationSeparate(L.FUNC_ADD,L.FUNC_ADD);let U=L.getUniformLocation(D,"viewport"),$=L.getUniformLocation(D,"projection"),R=L.getUniformLocation(D,"view"),C=L.getUniformLocation(D,"viewProjectionInverse"),F=L.getUniformLocation(D,"focal"),N=L.getUniformLocation(D,"splits"),I=L.getUniformLocation(D,"time"),P=L.getUniformLocation(D,"dt"),X=L.getUniformLocation(D,"spread"),V=L.getUniformLocation(D,"offsets"),q=L.getUniformLocation(D,"velocity"),Y=L.getUniformLocation(D,"speed"),H=L.getUniformLocation(D,"fade"),K=L.getUniformLocation(D,"scale"),B=L.getUniformLocation(D,"curve"),G=L.getUniformLocation(D,"slide"),J=L.createTexture();L.bindTexture(L.TEXTURE_2D,J);let W=L.getUniformLocation(D,"texture");L.uniform1iv(W,[0]);let ee=new Float32Array([-2,-2,2,-2,2,2,-2,2]),en=L.createBuffer();L.bindBuffer(L.ARRAY_BUFFER,en),L.bufferData(L.ARRAY_BUFFER,ee,L.STATIC_DRAW);let et=L.getAttribLocation(D,"position");L.enableVertexAttribArray(et),L.vertexAttribPointer(et,2,L.FLOAT,!1,0,0);let ei=L.createBuffer(),ea=L.getAttribLocation(D,"index");L.enableVertexAttribArray(ea),L.bindBuffer(L.ARRAY_BUFFER,ei),L.vertexAttribIPointer(ea,1,L.INT,!1,0,0),L.vertexAttribDivisor(ea,1);let el=()=>{L.uniform2fv(F,new Float32Array([nL.fx,nL.fy])),i=nO(nL.fx,nL.fy,innerWidth,innerHeight),L.uniform2fv(U,new Float32Array([innerWidth,innerHeight]));let e=nR.width=Math.round(innerWidth*m),n=nR.height=Math.round(innerHeight*m);L.viewport(0,0,e,n),L.uniformMatrix4fv($,!1,i)};window.addEventListener("resize",el),el(),u.onmessage=e=>{let{buffer:n,save:t,depthIndex:r,vertexCount:o,texdata:i,width:a,height:l,meta:s,freshData:c}=e.data;if(n){console.log("Update buffer",n.length);let e=new Uint8Array(n);if(t){A({data:e,...s}),S(g,_);let n=new Blob([e.buffer],{type:"application/octet-stream"}),t=document.createElement("a");t.download="model.splat",t.href=URL.createObjectURL(n),document.body.appendChild(t),t.click()}else z=e}else i?(console.log("Update texture",i.length),L.bindTexture(L.TEXTURE_2D,J),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_S,L.CLAMP_TO_EDGE),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_T,L.CLAMP_TO_EDGE),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MIN_FILTER,L.NEAREST),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MAG_FILTER,L.NEAREST),L.texImage2D(L.TEXTURE_2D,0,L.RGBA32UI,a,l,0,L.RGBA_INTEGER,L.UNSIGNED_INT,i),L.activeTexture(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,J),c&&w&&(b.slide=-Math.sign(w)*(g-1))):r&&(console.log("Update index",r.length,o),L.bindBuffer(L.ARRAY_BUFFER,ei),L.bufferData(L.ARRAY_BUFFER,r,L.DYNAMIC_DRAW),ew=o)};let es=[],ec=0;window.addEventListener("keydown",e=>{v=!1,es.includes(e.code)||es.push(e.code),/\d/.test(e.key)&&(nV=nM(nL=nS[ec=parseInt(e.key)])),["-","_"].includes(e.key)&&(ec=(ec+nS.length-1)%nS.length,nV=nM(nS[ec])),["+","="].includes(e.key)&&(ec=(ec+1)%nS.length,nV=nM(nS[ec])),"KeyV"===e.code?(location.hash="#"+JSON.stringify(nV,(e,n)=>Array.isArray(n)?n:Math.round(100*n)/100),nI.innerText="camera not set"):"KeyP"===e.code?(v=!0,nI.innerText="camera not set"):nI.innerText="camera "+ec}),window.addEventListener("keyup",e=>es=es.filter(n=>n!==e.code)),window.addEventListener("blur",()=>es=[]),window.addEventListener("wheel",e=>{v=!1,e.preventDefault();let n=1===e.deltaMode?10:2===e.deltaMode?innerHeight:1,t=nj(nV);e.shiftKey?t=nD(t,e.deltaX*n/innerWidth,e.deltaY*n/innerHeight,0):e.ctrlKey||e.metaKey?t=nD(t,0,0,-10*(e.deltaY*n)/innerHeight):(t=nk(t=nD(t,0,0,4),-(e.deltaX*n)/innerWidth,0,1,0),t=nD(t=nk(t,e.deltaY*n/innerHeight,1,0,0),0,0,-4)),nV=nj(t)},{passive:!1}),nR.addEventListener("mousedown",e=>{v=!1,e.preventDefault(),l=e.clientX,s=e.clientY,c=e.ctrlKey||e.metaKey?2:1}),nR.addEventListener("contextmenu",e=>{v=!1,e.preventDefault(),({clientX:l,clientY:s}=e),c=2}),nR.addEventListener("mousemove",e=>{if(e.preventDefault(),1==c){let n=nj(nV),t=5*(e.clientX-l)/innerWidth,r=5*(e.clientY-s)/innerHeight;n=nk(n=nD(n,0,0,4),t,0,1,0),nV=nj(n=nD(n=nk(n,-r,1,0,0),0,0,-4)),l=e.clientX,s=e.clientY}else if(2==c){let n=nj(nV);nV=nj(n=nD(n,-10*(e.clientX-l)/innerWidth,0,10*(e.clientY-s)/innerHeight)),l=e.clientX,s=e.clientY}}),nR.addEventListener("mouseup",e=>{e.preventDefault(),c=!1,l=s=0});let ef=0,ed=0;nR.addEventListener("touchstart",e=>{e.preventDefault(),1===e.touches.length?(v=!1,l=e.touches[0].clientX,s=e.touches[0].clientY,c=1):2===e.touches.length&&(v=!1,l=e.touches[0].clientX,ef=e.touches[1].clientX,s=e.touches[0].clientY,ed=e.touches[1].clientY,c=1)},{passive:!1}),nR.addEventListener("touchmove",e=>{let{touches:[n,t]}=e;if(e.preventDefault(),t){let e=Math.atan2(s-ed,l-ef)-Math.atan2(n.clientY-t.clientY,n.clientX-t.clientX),r=Math.hypot(l-ef,s-ed)/Math.hypot(n.clientX-t.clientX,n.clientY-t.clientY),o=(n.clientX+t.clientX-(l+ef))/2,i=(n.clientY+t.clientY-(s+ed))/2,a=nj(nV);a=nD(a=nk(a,e,0,0,1),-o/innerWidth,-i/innerHeight,0),nV=nj(a=nD(a,0,0,3*(1-r))),ef=t.clientX,ed=t.clientY}else if(c){let e=nj(nV),t=4*(n.clientX-l)/innerWidth,r=4*(n.clientY-s)/innerHeight;e=nk(e=nD(e,0,0,4),t,0,1,0),nV=nj(e=nD(e=nk(e,-r,1,0,0),0,0,-4))}l=n.clientX,s=n.clientY},{passive:!1}),nR.addEventListener("touchend",e=>{e.preventDefault(),c=!1,l=s=0},{passive:!1}),window.addEventListener("gamepadconnected",e=>{let n=navigator.getGamepads()[e.gamepad.index];console.log(`Gamepad connected at index ${n.index}: ${n.id}. It has ${n.buttons.length} buttons and ${n.axes.length} axes.`)}),window.addEventListener("gamepaddisconnected",e=>console.log("Gamepad disconnected"));let ev={mode:"cors",credentials:"omit",headers:{"Content-Type":"application/octet-stream"}},eu="true"===nP.get("stream"),ex=Object.assign([[1.93072,3.24839,-.736369]],nP.getAll("m-translate")).map(e=>e?Array.isArray(e)?e:JSON.parse(e):void 0),em=Object.assign([[-4.17982,-.031984,3.28073]],nP.getAll("m-rotate")).map(e=>e?Array.isArray(e)?e:JSON.parse(e):void 0),ep=Object.assign([[3.652,3.652,3.652]],nP.getAll("m-scale")).map(e=>e?Array.isArray(e)?e:JSON.parse(e):void 0),ey=[];async function eh(e){let n;let t=ey[e=nx(e,h.length)];if(console.log("Load model",e,x,t),x||t)return!x&&t;let r=ex[e],o=em[e],i=ep[e],a={data:null,translation:r,rotation:o,scale:i};A(a);let l=h[e],s=await fetch(l,ev),{status:c,url:f,body:d,headers:v}=s;if(console.log(s),200!==c)throw Error(c+" Unable to load "+f);if(x)return!1;let p=a.data=new Uint8Array(v.get("content-length"));p.length/32<5e5&&m!==(m=Math.max(m,devicePixelRatio))&&el(),console.log("Fetched data",p.length/32,m);let y=d.getReader(),w=0,b=0;function z(){a.size=b,A(a,+eu&&w),S(g,_)}for(let{done:e,value:t}=await y.read();!x&&!e;{done:e,value:t}=await y.read())p.set(t,w=b),b+=t.length,eu&&w!==b&&!1===(n??=eL(p,b))&&z();return console.log("Loaded data",p.length/32),!x&&((n??=eL(p))?u.postMessage({ply:p.buffer,save:!1,meta:{translation:r,rotation:o,scale:i}}):z(),ey[e]=a)}let eg=()=>Promise.all(Array(g).fill().reduce((e,n,t,r)=>(r[t]=eh(_+t))&&r,null));eg();let e_=0,ew=0,eb=0,ez=0,eA=Date.now(),eE=0,eS=e=>{let n=nj(nV),t=es.includes("Shift")||es.includes("ShiftLeft")||es.includes("ShiftRight");es.includes("ArrowUp")&&(n=t?nD(n,0,-.03,0):nD(n,0,0,.1)),es.includes("ArrowDown")&&(n=t?nD(n,0,.03,0):nD(n,0,0,-.1)),es.includes("ArrowLeft")&&(n=nD(n,-.03,0,0)),es.includes("ArrowRight")&&(n=nD(n,.03,0,0)),es.includes("KeyA")&&(n=nk(n,-.01,0,1,0)),es.includes("KeyD")&&(n=nk(n,.01,0,1,0)),es.includes("KeyQ")&&(n=nk(n,.01,0,0,1)),es.includes("KeyE")&&(n=nk(n,-.01,0,0,1)),es.includes("KeyW")&&(n=nk(n,.005,1,0,0)),es.includes("KeyS")&&(n=nk(n,-.005,1,0,0));let r=navigator.getGamepads?navigator.getGamepads():[],o=es.includes("Space");for(let e of r){if(!e)continue;Math.abs(e.axes[0])>.1&&(n=nD(n,.06*e.axes[0],0,0),v=!1),Math.abs(e.axes[1])>.1&&(n=nD(n,0,0,-.06*e.axes[1]),v=!1),(e.buttons[12].pressed||e.buttons[13].pressed)&&(n=nD(n,0,-.06*(e.buttons[12].pressed-e.buttons[13].pressed),0),v=!1),(e.buttons[14].pressed||e.buttons[15].pressed)&&(n=nD(n,-.06*(e.buttons[14].pressed-e.buttons[15].pressed),0,0),v=!1),Math.abs(e.axes[2])>.1&&(n=nk(n,.02*e.axes[2],0,1,0),v=!1),Math.abs(e.axes[3])>.1&&(n=nk(n,-.02*e.axes[3],1,0,0),v=!1);let t=e.buttons[6].value-e.buttons[7].value;Math.abs(t)>.1&&(n=nk(n,.02*t,0,0,1),v=!1),e.buttons[4].pressed&&!f&&(n=nj(nM(nL=nS[(nS.indexOf(nL)+1)%nS.length])),v=!1),e.buttons[5].pressed&&!d&&(n=nj(nM(nL=nS[(nS.indexOf(nL)+nS.length-1)%nS.length])),v=!1),f=e.buttons[4].pressed,d=e.buttons[5].pressed,e.buttons[0].pressed&&(o=!0,v=!1),e.buttons[3].pressed&&(v=!0)}["KeyJ","KeyK","KeyL","KeyI"].some(e=>es.includes(e))&&(n=nk(n=nD(n,0,0,4),es.includes("KeyJ")?-.05:.05*!!es.includes("KeyL"),0,1,0),n=nD(n=nk(n,es.includes("KeyI")?.05:es.includes("KeyK")?-.05:0,1,0,0),0,0,-4)),nV=nj(n);let l=eE,s=(eE=Date.now()-eA)-l;if(L.uniform1f(I,eE),L.uniform1f(P,s),L.uniform1f(N,y.length),w){let e=Math.sign(w),n=(g-1)*e;b.slide*e<=n&&(b.slide+=w*s)*e>n&&(_+=n,eg().then(()=>S(g,_,!0)))}let{spread:c,offsets:x,velocity:m,speed:p,fade:h,scale:A,curve:E,slide:O}=b;if(L.uniform1f(X,c),L.uniform1f(V,x),L.uniform3fv(q,m),L.uniform1f(Y,p),L.uniform1f(H,h),L.uniform1f(K,A),L.uniform3fv(B,E),L.uniform1f(G,O),v){let e=nj(nU),n=Math.sin(eE/5e3);nV=nj(e=nk(e=nD(e,2.5*n,0,6*(1-Math.cos(n))),-.6*n,0,1,0))}e_=o?Math.min(1,e_+.05):Math.max(0,e_-.05);let M=nj(nV),T=nj(M=nk(M=nD(M,0,-e_,0),-.1*e_,1,0,0));a=nT(i,T),u.postMessage({viewProjection:a}),ez=.9*ez+.1*(1e3/(e-eb)||0),ew>0?(L.uniformMatrix4fv(C,!1,nj(a)),L.uniformMatrix4fv(R,!1,T),L.clear(L.COLOR_BUFFER_BIT),L.drawArraysInstanced(L.TRIANGLE_FAN,0,4,ew),nF.style.display="none"):(L.clear(L.COLOR_BUFFER_BIT),nF.style.display="",eA=Date.now());let j=ew/(z.length/32);nC.style.transform=`scaleX(${j})`,nC.style.display=j<1?"":"none",nN.innerText=(Number.isFinite(ez)?Math.round(ez):"unknown")+" fps",nI.innerText="camera "+(isNaN(ec)?"not set":ec),eb=e,requestAnimationFrame(eS)};eS();let eL=(()=>{let e="ply\n".split("").map(e=>e.charCodeAt(0));return(n,t=4)=>t<4?null:e.every((e,t)=>e===n[t])})(),eO=e=>{let n=new FileReader;/\.json$/i.test(e.name)?(n.onload=()=>{nV=nM((nS=JSON.parse(n.result))[0]),i=nO(nL.fx,nL.fy,nR.width,nR.height),L.uniformMatrix4fv($,!1,i),console.log("Loaded Cameras")},n.readAsText(e)):(x=!0,n.onload=()=>{let e=new Uint8Array(n.result);console.log("Loaded",Math.floor(e.length/32)),eL(e)?u.postMessage({ply:e.buffer,save:!0}):(A({data:e}),S(g,_))},n.readAsArrayBuffer(e))};window.addEventListener("hashchange",e=>{try{nV=JSON.parse(decodeURIComponent(location.hash.slice(1))),v=!1}catch(e){}});let eM=e=>{e.preventDefault(),e.stopPropagation()};document.addEventListener("dragenter",eM),document.addEventListener("dragover",eM),document.addEventListener("dragleave",eM),document.addEventListener("drop",e=>{e.preventDefault(),e.stopPropagation(),eO(e.dataTransfer.files[0])})}nq=nY(nK,nH.getOrigin(nK),!1),(async()=>{try{await nB()}catch(e){nF.style.color="red",console.error(e)}})()}();