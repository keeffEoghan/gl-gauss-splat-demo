let e;function n(e){return e&&e.__esModule?e.default:e}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},o={},r={},i=t.parcelRequire94c2;null==i&&((i=function(e){if(e in o)return o[e].exports;if(e in r){var n=r[e];delete r[e];var t={id:e,exports:{}};return o[e]=t,n.call(t.exports,t,t.exports),t.exports}var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,n){r[e]=n},t.parcelRequire94c2=i),(0,i.register)("hYdCx",function(e,n){Object.defineProperty(e.exports,"register",{get:function(){return t},set:function(e){return t=e},enumerable:!0,configurable:!0});var t,o=new Map;t=function(e,n){for(var t=0;t<n.length-1;t+=2)o.set(n[t],{baseUrl:e,path:n[t+1]})}}),i("hYdCx").register(new URL("",import.meta.url).toString(),JSON.parse('["5JEMJ","index.875e87a1.js","hlVKh","worker.16797bd4.js"]'));const a=(e,n=e=>void 0!==e?": "+e:"")=>class extends Error{origMessage;constructor(t){super(e(t)+n(t)),this.origMessage=void 0!==t?String(t):""}},s=a(()=>"illegal arity"),l=e=>{throw new s(e)},c=(e,n)=>"function"==typeof e?.[n],f=e=>c(e,"xform")?e.xform():e,d=e=>"function"==typeof e?.[Symbol.iterator],v=(e,n)=>[e[0],e[1],n],u=Symbol(),x=()=>{},m=e=>e,p=e=>null!=e&&"function"!=typeof e&&void 0!==e.length;class y{value;constructor(e){this.value=e}deref(){return this.value}}const h=e=>new y(e),g=e=>e instanceof y,_=e=>e instanceof y?e:new y(e),w=e=>e instanceof y?e.deref():e,b=e=>2===e.length?[void 0,e[1]]:3===e.length?[e[1],e[2]]:l(e.length);function z(...e){let n=e[0],t=n[0],o=n[1],r=n[2],i=null==(e=b(e))[0]?t():e[0],a=e[1];return w(o(c(a,"$reduce")?a.$reduce(r,i):p(a)?A(r,i,a):E(r,i,a)))}const A=(e,n,t)=>{for(let o=0,r=t.length;o<r;o++)if(g(n=e(n,t[o]))){n=n.deref();break}return n},E=(e,n,t)=>{for(let o of t)if(g(n=e(n,o))){n=n.deref();break}return n},S=(e,n)=>[e,m,n];function*L(e,n){let t=f(e)([x,x,(e,n)=>n])[2];for(let e of n){let n=t(u,e);if(g(n)){(n=w(n.deref()))!==u&&(yield n);return}n!==u&&(yield n)}}const M=(e,n,t=L)=>{let o=n.length-1;return d(n[o])?n.length>1?t(e.apply(null,n.slice(0,o)),n[o]):t(e(),n[0]):void 0};function T(e,n){return d(n)?L(T(e),n):n=>{let t=n[2];return v(n,(n,o)=>t(n,e(o)))}}class O{from;to;step;constructor(e,n,t){void 0===e?(e=0,n=1/0):void 0===n&&(n=e,e=0),t=void 0===t?e<n?1:-1:t,this.from=e,this.to=n,this.step=t}*[Symbol.iterator](){let{from:e,to:n,step:t}=this;if(t>0)for(;e<n;)yield e,e+=t;else if(t<0)for(;e>n;)yield e,e+=t}$reduce(e,n){let t=this.step;if(t>0)for(let o=this.from,r=this.to;o<r&&!g(n);o+=t)n=e(n,o);else for(let o=this.from,r=this.to;o>r&&!g(n);o+=t)n=e(n,o);return n}}const j=(e,n,t)=>{let o,r;switch(t.length){case 4:r=t[3],o=t[2];break;case 3:r=t[2];break;case 2:return T(n=>e(t[0],t[1],n));default:l(t.length)}return n(f(t[0])(t[1]),o,r)};function*k(...e){let n=e.map(e=>e[Symbol.iterator]());for(;;){let e=[];for(let t of n){let n=t.next();if(n.done)return;e.push(n.value)}yield e}}const D=a(()=>"unsupported operation"),U=e=>{throw new D(e)},$=([e,n])=>`${e}*${n}`,R=e=>n=>n>1?`${e}[i${e}+${n}*s${e}]`:1==n?`${e}[i${e}+s${e}]`:`${e}[i${e}]`,C=e=>T(R(e),new O(void 0,void 0,void 0)),F=e=>T(n=>`${e}[${n}]`,new O(void 0,void 0,void 0)),N=(e,n,t,o="a",r="",i="",a="",s=!1)=>{var c;let u;return[i,function e(...n){return j(e,z,n)}(function(...e){return(function e(...n){let[t,o,r,i,a,s,c,f,d,v]=n;switch(n.length){case 0:l(0);case 1:return t;case 2:return(...e)=>t(o(...e));case 3:return(...e)=>t(o(r(...e)));case 4:return(...e)=>t(o(r(i(...e))));case 5:return(...e)=>t(o(r(i(a(...e)))));case 6:return(...e)=>t(o(r(i(a(s(...e))))));case 7:return(...e)=>t(o(r(i(a(s(c(...e)))))));case 8:return(...e)=>t(o(r(i(a(s(c(f(...e))))))));case 9:return(...e)=>t(o(r(i(a(s(c(f(d(...e)))))))));default:let u=(...e)=>t(o(r(i(a(s(c(f(d(v(...e))))))))));return 10===n.length?u:e(u,...n.slice(10))}}).apply(null,e=e.map(f))}(function e(n,t){return d(t)?function*(e,n){let t=f(e)(S(()=>[],(e,n)=>(e.push(n),e))),o=t[1],r=t[2];for(let e of n){let n=r([],e);if(g(n)){yield*w(o(n.deref()));return}n.length&&(yield*n)}yield*w(o([]))}(e(n),t):e=>{let t=e[2],o=n;return v(e,(e,n)=>--o>0?t(e,n):0===o?_(t(e,n)):h(e))}}(e),function e(...n){return M(e,n)||(e=>{let t=e[2],o=n[0],r=n[1]||0;return v(e,(e,n)=>t(e,o(r++,n)))})}((e,t)=>n(t,e))),(c=(c=r)||"",u=!0,S(()=>"",(e,n)=>(e=u?e+n:e+c+n,u=!1,e))),k.apply(null,t.split(",").map(s?C:F))),a,""!==o?`return ${o};`:""]},I=(e,n,t,o=t,r="a",i,a,s,l=!1)=>Function(t,N(e,n,o,r,i,a,s,l).join("")),P=e=>I(e,$,"o,a,io=0,ia=0,so=1,sa=1","o,a","","+","return ",";",!0),X=P(2),V=P(3),q=P(4),Y=(e,n,t)=>(e||(e=[]),e[0]=n,e[1]=t,e),H=(e,n,t,o)=>(e||(e=[]),e[0]=n,e[1]=t,e[2]=o,e),K=(e,n,t,o,r)=>(e||(e=[]),e[0]=n,e[1]=t,e[2]=o,e[3]=r,e),G=(e,...n)=>{if(!e)return n;for(let t=0,o=n.length;t<o;t++)e[t]=n[t];return e},B=((e=0)=>{let n;let t=[,,,,,],o=(...o)=>{let r=t[o[e].length]||n;return r?r(...o):U(`no impl for vec size ${o[e].length}`)};return o.add=(e,n)=>t[e]=n,o.default=e=>n=e,o.impl=e=>t[e]||n,o})(1);B.add(4,(e,n,t)=>Y(e||t,X(n,t,0,0,2),X(n,t,1,0,2))),B.add(6,(e,n,t)=>Y(e||t,X(n,t,0,0,2)+n[4],X(n,t,1,0,2)+n[5])),B.add(9,(e,n,t)=>H(e||t,V(n,t,0,0,3),V(n,t,1,0,3),V(n,t,2,0,3))),B.add(16,(e,n,t)=>K(e||t,q(n,t,0,0,4),q(n,t,1,0,4),q(n,t,2,0,4),q(n,t,3,0,4)));const J=(e,n,t)=>{let o=V(n,t,3,0,4)+n[15];return 0!==o?H(e||t,(V(n,t,0,0,4)+n[12])/o,(V(n,t,1,0,4)+n[13])/o,(V(n,t,2,0,4)+n[14])/o):void 0},W=(e,n,t)=>{let{0:o,1:r,2:i,3:a}=n,{0:s,1:l,2:c,3:f}=t;return K(e||n,o*f+a*s+r*c-i*l,r*f+a*l+i*s-o*c,i*f+a*c+o*l-r*s,a*f-o*s-r*l-i*c)},Q=-1/0,Z=1/0;Object.freeze([Q,Q]),Object.freeze([Z,Z]),Object.freeze([1,1]),Object.freeze([0,0]),Object.freeze([1,0]),Object.freeze([0,1]),Object.freeze([Q,Q,Q]),Object.freeze([Z,Z,Z]),Object.freeze([1,1,1]);const ee=Object.freeze([0,0,0]);Object.freeze([1,0,0]),Object.freeze([0,1,0]),Object.freeze([0,0,1]),Object.freeze([Q,Q,Q,Q]),Object.freeze([Z,Z,Z,Z]),Object.freeze([1,1,1,1]),Object.freeze([0,0,0,0]),Object.freeze([1,0,0,0]),Object.freeze([0,1,0,0]),Object.freeze([0,0,1,0]),Object.freeze([0,0,0,1]);const en=(e,n,t=ee)=>{let[o,r,i,a]=n,s=o+o,l=r+r,c=i+i,f=o*s,d=o*l,v=o*c,u=r*l,x=r*c,m=i*c,p=a*s,y=a*l,h=a*c;return G(e||[],1-u-m,d+h,v-y,0,d-h,1-f-m,x+p,0,v+y,x-p,1-f-u,0,t[0],t[1],t[2],1)},et=(e,n,t,o,r)=>(e||(e=[]),e[0]=n,e[1]=t,e[2]=o,e[3]=r,e),eo=(e,n=e=>void 0!==e?": "+e:"")=>class extends Error{origMessage;constructor(t){super(e(t)+n(t)),this.origMessage=void 0!==t?String(t):""}},er=eo(()=>"illegal arity"),ei=e=>{throw new er(e)},ea=(e,n)=>"function"==typeof e?.[n],es=e=>ea(e,"xform")?e.xform():e,el=e=>"function"==typeof e?.[Symbol.iterator],ec=(e,n)=>[e[0],e[1],n],ef=Symbol(),ed=()=>{},ev=e=>e,eu=e=>null!=e&&"function"!=typeof e&&void 0!==e.length;class ex{value;constructor(e){this.value=e}deref(){return this.value}}const em=e=>new ex(e),ep=e=>e instanceof ex,ey=e=>e instanceof ex?e:new ex(e),eh=e=>e instanceof ex?e.deref():e,eg=e=>2===e.length?[void 0,e[1]]:3===e.length?[e[1],e[2]]:ei(e.length);function e_(...e){let n=e[0],t=n[0],o=n[1],r=n[2],i=null==(e=eg(e))[0]?t():e[0],a=e[1];return eh(o(ea(a,"$reduce")?a.$reduce(r,i):eu(a)?ew(r,i,a):eb(r,i,a)))}const ew=(e,n,t)=>{for(let o=0,r=t.length;o<r;o++)if(ep(n=e(n,t[o]))){n=n.deref();break}return n},eb=(e,n,t)=>{for(let o of t)if(ep(n=e(n,o))){n=n.deref();break}return n},ez=(e,n)=>[e,ev,n];function*eA(e,n){let t=es(e)([ed,ed,(e,n)=>n])[2];for(let e of n){let n=t(ef,e);if(ep(n)){(n=eh(n.deref()))!==ef&&(yield n);return}n!==ef&&(yield n)}}const eE=(e,n,t=eA)=>{let o=n.length-1;return el(n[o])?n.length>1?t(e.apply(null,n.slice(0,o)),n[o]):t(e(),n[0]):void 0};function eS(e,n){return el(n)?eA(eS(e),n):n=>{let t=n[2];return ec(n,(n,o)=>t(n,e(o)))}}class eL{from;to;step;constructor(e,n,t){void 0===e?(e=0,n=1/0):void 0===n&&(n=e,e=0),t=void 0===t?e<n?1:-1:t,this.from=e,this.to=n,this.step=t}*[Symbol.iterator](){let{from:e,to:n,step:t}=this;if(t>0)for(;e<n;)yield e,e+=t;else if(t<0)for(;e>n;)yield e,e+=t}$reduce(e,n){let t=this.step;if(t>0)for(let o=this.from,r=this.to;o<r&&!ep(n);o+=t)n=e(n,o);else for(let o=this.from,r=this.to;o>r&&!ep(n);o+=t)n=e(n,o);return n}}const eM=(e,n,t)=>{let o,r;switch(t.length){case 4:r=t[3],o=t[2];break;case 3:r=t[2];break;case 2:return eS(n=>e(t[0],t[1],n));default:ei(t.length)}return n(es(t[0])(t[1]),o,r)};function*eT(...e){let n=e.map(e=>e[Symbol.iterator]());for(;;){let e=[];for(let t of n){let n=t.next();if(n.done)return;e.push(n.value)}yield e}}const eO=eo(()=>"unsupported operation"),ej=e=>{throw new eO(e)},ek=(e=0)=>{let n;let t=[,,,,,],o=(...o)=>{let r=t[o[e].length]||n;return r?r(...o):ej(`no impl for vec size ${o[e].length}`)};return o.add=(e,n)=>t[e]=n,o.default=e=>n=e,o.impl=e=>t[e]||n,o},eD="o,a,b",eU="o,a,n",e$="io=0,ia=0,ib=0,so=1,sa=1,sb=1",eR="!o&&(o=a);",eC=e=>([n,t])=>`${n}=${t}${e}n;`,eF=e=>n=>n>1?`${e}[i${e}+${n}*s${e}]`:1==n?`${e}[i${e}+s${e}]`:`${e}[i${e}]`,eN=e=>eS(eF(e),new eL(void 0,void 0,void 0)),eI=e=>eS(n=>`${e}[${n}]`,new eL(void 0,void 0,void 0)),eP=(e,n,t,o="a",r="",i="",a="",s=!1)=>{var l;let c;return[i,function e(...n){return eM(e,e_,n)}(function(...e){return(function e(...n){let[t,o,r,i,a,s,l,c,f,d]=n;switch(n.length){case 0:ei(0);case 1:return t;case 2:return(...e)=>t(o(...e));case 3:return(...e)=>t(o(r(...e)));case 4:return(...e)=>t(o(r(i(...e))));case 5:return(...e)=>t(o(r(i(a(...e)))));case 6:return(...e)=>t(o(r(i(a(s(...e))))));case 7:return(...e)=>t(o(r(i(a(s(l(...e)))))));case 8:return(...e)=>t(o(r(i(a(s(l(c(...e))))))));case 9:return(...e)=>t(o(r(i(a(s(l(c(f(...e)))))))));default:let v=(...e)=>t(o(r(i(a(s(l(c(f(d(...e))))))))));return 10===n.length?v:e(v,...n.slice(10))}}).apply(null,e=e.map(es))}(function e(n,t){return el(t)?function*(e,n){let t=es(e)(ez(()=>[],(e,n)=>(e.push(n),e))),o=t[1],r=t[2];for(let e of n){let n=r([],e);if(ep(n)){yield*eh(o(n.deref()));return}n.length&&(yield*n)}yield*eh(o([]))}(e(n),t):e=>{let t=e[2],o=n;return ec(e,(e,n)=>--o>0?t(e,n):0===o?ey(t(e,n)):em(e))}}(e),function e(...n){return eE(e,n)||(e=>{let t=e[2],o=n[0],r=n[1]||0;return ec(e,(e,n)=>t(e,o(r++,n)))})}((e,t)=>n(t,e))),(l=(l=r)||"",c=!0,ez(()=>"",(e,n)=>(e=c?e+n:e+l+n,c=!1,e))),eT.apply(null,t.split(",").map(s?eN:eI))),a,""!==o?`return ${o};`:""]},eX=(e,n,t="a",o,r,i=!1)=>[o,"for(let i=a.length;--i>=0;) {",e(n.split(",").map(i?e=>`${e}[i${e}+i*s${e}]`:e=>`${e}[i]`)),"}",r,null!==t?`return ${t};`:""],eV=(e,n=eD,t="o",o=eR,r)=>[o,"while(k--\x3e0) {",e(n.split(",").map(e=>`${e}[i${e}+k*s${e}]`)),"}",r,null!==t?`return ${t};`:""],eq=(e,n)=>`!${e} && (${e}=${n.split(",")[1]});`,eY=(e,n,t,o=t,r="a",i,a,s,l=!1)=>Function(t,eP(e,n,o,r,i,a,s,l).join("")),eH=(e,n,t=n,o="a",r,i,a=!1)=>Function(n,eX(e,t,o,r,i,a).join("")),eK=(e,n,t=n,o,r,i)=>Function(n,eV(e,t,o,r,i).join("")),eG=(e,n=eD,t,o="o",r=1,i)=>{t=t||n,i=null!=i?i:eq(o,t);let a=ek(r),s=r=>a.add(r,eY(r,e,n,t,o,"",i));return a.default(eH(e,n,t,o,i)),[a,s(2),s(3),s(4)]},eB=e=>eG(eC(e),eU),[eJ,eW,eQ,eZ]=eG(([e,n,t])=>`${e}=${n}*${t};`),[e0,e1,e2,e3]=eB("*"),[e4,e5,e9,e8]=((e,n=eD,t=e$,o=eD,r="o",i,a=[2,3,4])=>[eK(e,`${n},k,${t}`,o,r,void 0),...a.map(i=>eY(i,e,`${n},${t}`,o,r,"",eq(r,o),"",!0))])(eC("*"),eU,"io=0,ia=0,so=1,sa=1","o,a"),[e6,e7,ne,nn]=eB("+"),nt=e=>no.add(e,eY(e,([e])=>`${e}*${e}`,"a","a","","+","return ",";")),no=ek();no.default(eH(([e])=>`sum+=${e}*${e};`,"a",void 0,"sum","let sum=0;")),nt(2);const nr=nt(3),ni=nt(4),[na,ns,nl,nc]=eG(([e,n])=>`${e}=${n};`,"o,a",void 0,"o",1,"!o&&(o=[]);"),nf=(e,n,t=1)=>{e||(e=n);let o=Math.sqrt(nr(n));return o>=1e-6?e2(e,n,t/o):e!==n?nl(e,n):e},nd=(e,n,t=1)=>{e||(e=n);let o=Math.sqrt(ni(n));return o>=1e-6?e3(e,n,t/o):e!==n?nc(e,n):e},nv=(e,n)=>(e%n+n)%n,nu=-1/0,nx=1/0;Object.freeze([nu,nu]),Object.freeze([nx,nx]),Object.freeze([1,1]),Object.freeze([0,0]),Object.freeze([1,0]),Object.freeze([0,1]),Object.freeze([nu,nu,nu]),Object.freeze([nx,nx,nx]),Object.freeze([1,1,1]),Object.freeze([0,0,0]);const nm=Object.freeze([1,0,0]),np=Object.freeze([0,1,0]),ny=Object.freeze([0,0,1]);Object.freeze([nu,nu,nu,nu]),Object.freeze([nx,nx,nx,nx]),Object.freeze([1,1,1,1]),Object.freeze([0,0,0,0]),Object.freeze([1,0,0,0]),Object.freeze([0,1,0,0]),Object.freeze([0,0,1,0]),Object.freeze([0,0,0,1]);const{sin:nh,cos:ng}=Math,n_={xyz:[nm,np,ny],yxz:[np,nm,ny],xzy:[nm,ny,np],zxy:[ny,nm,np],yzx:[np,ny,nm],zyx:[ny,np,nm]};function nw(e,n,t=0){return(e||(e=[]))[3]=ng(t*=.5),nf(e,n,nh(t))}var nb={};nb="precision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\nuniform vec2 viewport;\nuniform mat4 projection;\nuniform mat4 view;\nuniform vec2 focal;\nuniform highp usampler2D texture;\n\n#if defined(maskLocal) && !defined(maskCenter)\n  uniform mat4 viewProjectionInverse;\n#endif\n\n#ifndef maskFrag\n  uniform float splits;\n  uniform float time;\n  uniform float dt;\n  uniform float offsets;\n  uniform vec3 velocity;\n  uniform float speed;\n  uniform float fade;\n  uniform float scale;\n  uniform vec3 curve;\n  uniform float slide;\n#endif\n\nin vec2 position;\nin int index;\n\n#ifdef maskFrag\n  out vec3 vAt;\n  out float vMeta;\n#else\n  out float vMask;\n#endif\n\nout vec4 vColor;\nout vec2 vPosition;\n\nfloat when_eq_1540259130(float x, float y) {\n  return 1.0 - abs(sign(x - y));\n}\n\nvec2 when_eq_1540259130(vec2 x, vec2 y) {\n  return 1.0 - abs(sign(x - y));\n}\n\nvec3 when_eq_1540259130(vec3 x, vec3 y) {\n  return 1.0 - abs(sign(x - y));\n}\n\nvec4 when_eq_1540259130(vec4 x, vec4 y) {\n  return 1.0 - abs(sign(x - y));\n}\n\n#ifndef maskFrag\n  //\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute(vec4 x) {\n     return mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat snoise(vec3 v)\n  {\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min( g.xyz, l.zxy );\n  vec3 i2 = max( g.xyz, l.zxy );\n\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod289(i);\n  vec4 p = permute( permute( permute(\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3  ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n  }\n\nvec3 snoiseVec3( vec3 x ){\n\n  float s  = snoise(vec3( x ));\n  float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n  float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n  vec3 c = vec3( s , s1 , s2 );\n  return c;\n\n}\n\nvec3 curlNoise( vec3 p ){\n  \n  const float e = .1;\n  vec3 dx = vec3( e   , 0.0 , 0.0 );\n  vec3 dy = vec3( 0.0 , e   , 0.0 );\n  vec3 dz = vec3( 0.0 , 0.0 , e   );\n\n  vec3 p_x0 = snoiseVec3( p - dx );\n  vec3 p_x1 = snoiseVec3( p + dx );\n  vec3 p_y0 = snoiseVec3( p - dy );\n  vec3 p_y1 = snoiseVec3( p + dy );\n  vec3 p_z0 = snoiseVec3( p - dz );\n  vec3 p_z1 = snoiseVec3( p + dz );\n\n  float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n  float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n  float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n\n  const float divisor = 1.0 / ( 2.0 * e );\n  return normalize( vec3( x , y , z ) * divisor );\n\n}\n\nfloat range(float vmin, float vmax, float value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\nvec2 range(vec2 vmin, vec2 vmax, vec2 value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\nvec3 range(vec3 vmin, vec3 vmax, vec3 value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\nvec4 range(vec4 vmin, vec4 vmax, vec4 value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\nfloat when_gt_529295689(float x, float y) {\n  return max(sign(x - y), 0.0);\n}\n\nvec2 when_gt_529295689(vec2 x, vec2 y) {\n  return max(sign(x - y), 0.0);\n}\n\nvec3 when_gt_529295689(vec3 x, vec3 y) {\n  return max(sign(x - y), 0.0);\n}\n\nvec4 when_gt_529295689(vec4 x, vec4 y) {\n  return max(sign(x - y), 0.0);\n}\n\nfloat when_le_2315452051(float x, float y) {\n  return 1.0 - when_gt_529295689(x, y);\n}\n\nvec2 when_le_2315452051(vec2 x, vec2 y) {\n  return 1.0 - when_gt_529295689(x, y);\n}\n\nvec3 when_le_2315452051(vec3 x, vec3 y) {\n  return 1.0 - when_gt_529295689(x, y);\n}\n\nvec4 when_le_2315452051(vec4 x, vec4 y) {\n  return 1.0 - when_gt_529295689(x, y);\n}\n\nfloat when_lt_2281831123(float x, float y) {\n  return max(sign(y - x), 0.0);\n}\n\nvec2 when_lt_2281831123(vec2 x, vec2 y) {\n  return max(sign(y - x), 0.0);\n}\n\nvec3 when_lt_2281831123(vec3 x, vec3 y) {\n  return max(sign(y - x), 0.0);\n}\n\nvec4 when_lt_2281831123(vec4 x, vec4 y) {\n  return max(sign(y - x), 0.0);\n}\n\nfloat flow(vec3 at,\n    float split, float splits,\n    float time, float dt, float offsets, vec3 velocity, float speed,\n    float fade, float scale, vec3 curve, float slide) {\n  at += time*velocity;\n\n  float to;\n  // float to = simplexNoise(at*scale);\n\n  for(float i = 0.0; i < offsets; ++i) {\n    at += curlNoise(at)*speed;\n    // at += curlNoise(at)*speed*(time*velocity);\n    // at += curlNoise(at+(dt*velocity))*speed;\n    // at += curlNoise(at+(time*velocity))*speed;\n    // to = mix(to, simplexNoise(at*scale), fade);\n  }\n\n  to = range(-1.0, 1.0, snoise(at*scale));\n  to = (clamp((pow(to, curve.x)*curve.y)+curve.z, 0.0, 1.0)*splits)+slide;\n\n  // return le(split, to)*lt(to, split+1.0);\n  return min(1.0,\n    (when_le_2315452051(split, to)*when_lt_2281831123(to, split+1.0))+\n      (when_le_2315452051(split, 0.0)*when_le_2315452051(to, 0.0))+\n      (when_le_2315452051(splits, split+1.0)*when_le_2315452051(splits, to)));\n}\n\n#endif\n\nconst vec4 none = vec4(0.0, 0.0, 2.0, 1.0);\n\nvoid main() {\n  uvec4 data = texelFetch(texture,\n    ivec2((uint(index)&0x3ffu) << 1, uint(index) >> 10), 0);\n\n  vec4 atData = uintBitsToFloat(data);\n  vec3 at = atData.xyz;\n  float meta = atData.w;\n  vec4 atView = view*vec4(at, 1);\n  vec4 atScreen = projection*atView;\n  float clip = 1.2*atScreen.w;\n\n  bool clipped = (atScreen.z < -clip) || (atScreen.x < -clip) ||\n    (atScreen.x > clip) || (atScreen.y < -clip) || (atScreen.y > clip);\n\n  if(clipped) {\n    gl_Position = none;\n\n    return;\n  }\n\n  uvec4 cov = texelFetch(texture,\n    ivec2(((uint(index)&0x3ffu) << 1) | 1u, uint(index) >> 10), 0);\n\n  vec2 u1 = unpackHalf2x16(cov.x);\n  vec2 u2 = unpackHalf2x16(cov.y);\n  vec2 u3 = unpackHalf2x16(cov.z);\n  mat3 Vrk = mat3(u1.x, u1.y, u2.x, u1.y, u2.y, u3.x, u2.x, u3.x, u3.y);\n\n  mat3 J = mat3(focal.x/atView.z, 0.0, -(focal.x*atView.x)/(atView.z*atView.z),\n    0.0, -focal.y/atView.z, (focal.y*atView.y)/(atView.z*atView.z),\n    0.0, 0.0, 0.0);\n\n  mat3 T = transpose(mat3(view))*J;\n  mat3 cov2d = transpose(T)*Vrk*T;\n  float mid = (cov2d[0][0]+cov2d[1][1])/2.0;\n  float radius = length(vec2((cov2d[0][0]-cov2d[1][1])/2.0, cov2d[0][1]));\n  float lambda1 = mid+radius;\n  float lambda2 = mid-radius;\n\n  if(lambda2 < 0.0) {\n    gl_Position = none;\n\n    return;\n  }\n\n  vec2 diagonal = normalize(vec2(cov2d[0][1], lambda1-cov2d[0][0]));\n  vec2 majorAxis = min(sqrt(2.0*lambda1), 1024.0)*diagonal;\n  vec2 minorAxis = min(sqrt(2.0*lambda2), 1024.0)*vec2(diagonal.y, -diagonal.x);\n  vec3 atSplat = (atScreen.xyz /= atScreen.w);\n\n  vec2 axes =\n    ((position.x*majorAxis)/viewport)+((position.y*minorAxis)/viewport);\n\n  atSplat.xy += axes;\n\n  uint rgba = cov.w;\n\n  vec4 color =\n    vec4(rgba&0xffu, (rgba >> 8)&0xffu, (rgba >> 16)&0xffu, (rgba >> 24)&0xffu);\n\n  vColor = (clamp(atSplat.z+1.0, 0.0, 1.0)*color)/255.0;\n\n  // vColor.r *= eq(meta, 0.0);\n  // vColor.g *= eq(meta, 1.0);\n  // vColor.b *= eq(meta, 2.0);\n\n  vPosition = position;\n\n  #if defined(maskLocal) && defined(maskCenter)\n    vec3 atMask = at;\n  #elif defined(maskLocal) && !defined(maskCenter)\n    vec3 atMask = vec3(viewProjectionInverse*vec4(atSplat, 1));\n  #elif defined(maskCenter)\n    vec3 atMask = atScreen.xyz;\n  #else\n    vec3 atMask = atSplat;\n  #endif\n\n  #ifdef maskFrag\n    vAt = atMask;\n    vMeta = meta;\n  #else\n    vMask = flow(atMask, meta, splits, time, dt, offsets, velocity, speed,\n      fade, scale, curve, slide);\n  #endif\n\n  gl_Position = vec4(atSplat.xy, 0, 1);\n}\n";var nz={};nz="precision highp float;\n#define GLSLIFY 1\n\n#define modeDiff 1\n#define modeGauss 2\n\n#ifdef maskFrag\n  uniform float splits;\n  uniform float time;\n  uniform float dt;\n  uniform float offsets;\n  uniform vec3 velocity;\n  uniform float speed;\n  uniform float fade;\n  uniform float scale;\n  uniform vec3 curve;\n  uniform float slide;\n#endif\n\n#if (maskMode == modeDiff) || (maskMode == modeGauss)\n  uniform float spread;\n#endif\n\n#ifdef maskFrag\n  in vec3 vAt;\n  in float vMeta;\n#else\n  in float vMask;\n#endif\n\nin vec4 vColor;\nin vec2 vPosition;\n\nout vec4 fragColor;\n\nfloat when_eq_1540259130(float x, float y) {\n  return 1.0 - abs(sign(x - y));\n}\n\nvec2 when_eq_1540259130(vec2 x, vec2 y) {\n  return 1.0 - abs(sign(x - y));\n}\n\nvec3 when_eq_1540259130(vec3 x, vec3 y) {\n  return 1.0 - abs(sign(x - y));\n}\n\nvec4 when_eq_1540259130(vec4 x, vec4 y) {\n  return 1.0 - abs(sign(x - y));\n}\n\n#ifdef maskFrag\n  //\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute(vec4 x) {\n     return mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat snoise(vec3 v)\n  {\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min( g.xyz, l.zxy );\n  vec3 i2 = max( g.xyz, l.zxy );\n\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod289(i);\n  vec4 p = permute( permute( permute(\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3  ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n  }\n\nvec3 snoiseVec3( vec3 x ){\n\n  float s  = snoise(vec3( x ));\n  float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n  float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n  vec3 c = vec3( s , s1 , s2 );\n  return c;\n\n}\n\nvec3 curlNoise( vec3 p ){\n  \n  const float e = .1;\n  vec3 dx = vec3( e   , 0.0 , 0.0 );\n  vec3 dy = vec3( 0.0 , e   , 0.0 );\n  vec3 dz = vec3( 0.0 , 0.0 , e   );\n\n  vec3 p_x0 = snoiseVec3( p - dx );\n  vec3 p_x1 = snoiseVec3( p + dx );\n  vec3 p_y0 = snoiseVec3( p - dy );\n  vec3 p_y1 = snoiseVec3( p + dy );\n  vec3 p_z0 = snoiseVec3( p - dz );\n  vec3 p_z1 = snoiseVec3( p + dz );\n\n  float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n  float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n  float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n\n  const float divisor = 1.0 / ( 2.0 * e );\n  return normalize( vec3( x , y , z ) * divisor );\n\n}\n\nfloat range(float vmin, float vmax, float value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\nvec2 range(vec2 vmin, vec2 vmax, vec2 value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\nvec3 range(vec3 vmin, vec3 vmax, vec3 value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\nvec4 range(vec4 vmin, vec4 vmax, vec4 value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\nfloat when_gt_529295689(float x, float y) {\n  return max(sign(x - y), 0.0);\n}\n\nvec2 when_gt_529295689(vec2 x, vec2 y) {\n  return max(sign(x - y), 0.0);\n}\n\nvec3 when_gt_529295689(vec3 x, vec3 y) {\n  return max(sign(x - y), 0.0);\n}\n\nvec4 when_gt_529295689(vec4 x, vec4 y) {\n  return max(sign(x - y), 0.0);\n}\n\nfloat when_le_2315452051(float x, float y) {\n  return 1.0 - when_gt_529295689(x, y);\n}\n\nvec2 when_le_2315452051(vec2 x, vec2 y) {\n  return 1.0 - when_gt_529295689(x, y);\n}\n\nvec3 when_le_2315452051(vec3 x, vec3 y) {\n  return 1.0 - when_gt_529295689(x, y);\n}\n\nvec4 when_le_2315452051(vec4 x, vec4 y) {\n  return 1.0 - when_gt_529295689(x, y);\n}\n\nfloat when_lt_2281831123(float x, float y) {\n  return max(sign(y - x), 0.0);\n}\n\nvec2 when_lt_2281831123(vec2 x, vec2 y) {\n  return max(sign(y - x), 0.0);\n}\n\nvec3 when_lt_2281831123(vec3 x, vec3 y) {\n  return max(sign(y - x), 0.0);\n}\n\nvec4 when_lt_2281831123(vec4 x, vec4 y) {\n  return max(sign(y - x), 0.0);\n}\n\nfloat flow(vec3 at,\n    float split, float splits,\n    float time, float dt, float offsets, vec3 velocity, float speed,\n    float fade, float scale, vec3 curve, float slide) {\n  at += time*velocity;\n\n  float to;\n  // float to = simplexNoise(at*scale);\n\n  for(float i = 0.0; i < offsets; ++i) {\n    at += curlNoise(at)*speed;\n    // at += curlNoise(at)*speed*(time*velocity);\n    // at += curlNoise(at+(dt*velocity))*speed;\n    // at += curlNoise(at+(time*velocity))*speed;\n    // to = mix(to, simplexNoise(at*scale), fade);\n  }\n\n  to = range(-1.0, 1.0, snoise(at*scale));\n  to = (clamp((pow(to, curve.x)*curve.y)+curve.z, 0.0, 1.0)*splits)+slide;\n\n  // return le(split, to)*lt(to, split+1.0);\n  return min(1.0,\n    (when_le_2315452051(split, to)*when_lt_2281831123(to, split+1.0))+\n      (when_le_2315452051(split, 0.0)*when_le_2315452051(to, 0.0))+\n      (when_le_2315452051(splits, split+1.0)*when_le_2315452051(splits, to)));\n}\n\n#endif\n\nvoid main() {\n  float d2 = dot(vPosition, vPosition);\n\n  if(d2 > 4.0) { discard; }\n\n  #ifdef maskFrag\n    float mask = flow(vAt, vMeta, splits, time, dt, offsets, velocity, speed,\n      fade, scale, curve, slide);\n  #else\n    float mask = vMask;\n  #endif\n\n  float a = exp(-d2);\n  vec4 color = vColor;\n\n  #if maskMode == modeDiff\n    a -= clamp(1.0-mask-spread, 0.0, 1.0);\n  #elif maskMode == modeGauss\n    mask = 1.0-mask;\n    a *= exp(-(mask*mask)/spread);\n    // a = exp(-(d2-(mask*mask)));\n  #else\n    a *= mask;\n  #endif\n\n  color.rgb *= (color.a *= a);\n\n  fragColor = color;\n}\n";const nA=new URLSearchParams(location.search),nE="true"===nA.debug;let nS=[{id:0,img_name:"00001",width:1959,height:1090,position:[-3.0089893469241797,-.11086489695181866,-3.7527640949141428],rotation:[[.876134201218856,.06925962026449776,.47706599800804744],[-.04747421839895102,.9972110940209488,-.057586739349882114],[-.4797239414934443,.027805376500959853,.8769787916452908]],fy:1164.6601287484507,fx:1159.5880733038064},{id:1,img_name:"00009",width:1959,height:1090,position:[-2.5199776022057296,-.09704735754873686,-3.6247725540304545],rotation:[[.9982731285632193,-.011928707708098955,-.05751927260507243],[.0065061360949636325,.9955928229282383,-.09355533724430458],[.058381769258182864,.09301955098900708,.9939511719154457]],fy:1164.6601287484507,fx:1159.5880733038064},{id:2,img_name:"00017",width:1959,height:1090,position:[-.7737533667465242,-.3364271945329695,-2.9358969417573753],rotation:[[.9998813418672372,.013742375651625236,-.0069605529394208224],[-.014268370388586709,.996512943252834,-.08220929105659476],[.00580653013657589,.08229885200307129,.9965907801935302]],fy:1164.6601287484507,fx:1159.5880733038064},{id:3,img_name:"00025",width:1959,height:1090,position:[1.2198221749590001,-.2196687861401182,-2.3183162007028453],rotation:[[.9208648867765482,.0012010625395201253,.389880004297208],[-.06298204172269357,.987319521752825,.14571693239364383],[-.3847611242348369,-.1587410451475895,.9092635249821667]],fy:1164.6601287484507,fx:1159.5880733038064},{id:4,img_name:"00033",width:1959,height:1090,position:[1.742387858893817,-.13848225198886954,-2.0566370113193146],rotation:[[.24669889292141334,-.08370189346592856,-.9654706879349405],[.11343747891376445,.9919082664242816,-.05700815184573074],[.9624300466054861,-.09545671285663988,.2541976029815521]],fy:1164.6601287484507,fx:1159.5880733038064},{id:5,img_name:"00041",width:1959,height:1090,position:[3.6567309419223935,-.16470990600750707,-1.3458085590422042],rotation:[[.2341293058324528,-.02968330457755884,-.9717522161434825],[.10270823606832301,.99469554638321,-.005638106875665722],[.9667649592295676,-.09848690996657204,.2359360976431732]],fy:1164.6601287484507,fx:1159.5880733038064},{id:6,img_name:"00049",width:1959,height:1090,position:[3.9013554243203497,-.2597500978038105,-.8106154188297828],rotation:[[.6717235545638952,-.015718162115524837,-.7406351366386528],[.055627354673906296,.9980224478387622,.029270992841185218],[.7387104058127439,-.060861588786650656,.6712695459756353]],fy:1164.6601287484507,fx:1159.5880733038064},{id:7,img_name:"00057",width:1959,height:1090,position:[4.742994605467533,-.05591660945412069,.9500365976084458],rotation:[[-.17042655709210375,.01207080756938,-.9852964448542146],[.1165090336695526,.9931575292530063,-.00798543433078162],[.9784581921120181,-.1161568667478904,-.1706667764862097]],fy:1164.6601287484507,fx:1159.5880733038064},{id:8,img_name:"00065",width:1959,height:1090,position:[4.34676307626522,.08168160516967145,1.0876221470355405],rotation:[[-.003575447631888379,-.044792503246552894,-.9989899137764799],[.10770152645126597,.9931680875192705,-.04491693593046672],[.9941768441149182,-.10775333677534978,.0012732004866391048]],fy:1164.6601287484507,fx:1159.5880733038064},{id:9,img_name:"00073",width:1959,height:1090,position:[3.264984351114202,.078974937336732,1.0117200284114904],rotation:[[-.026919994628162257,-.1565891128261527,-.9872968974090509],[.08444552208239385,.983768234577625,-.1583319754069128],[.9960643893290491,-.0876350978794554,-.013259786205163005]],fy:1164.6601287484507,fx:1159.5880733038064}],nL=nS[0];function nM(e,n,t,o){return[2*e/t,0,0,0,0,-(2*n)/o,0,0,0,0,200/199.8,1,0,0,-.20020020020020018,0]}function nT(e){let n=e.rotation.flat(),t=e.position;return[n[0],n[1],n[2],0,n[3],n[4],n[5],0,n[6],n[7],n[8],0,-t[0]*n[0]-t[1]*n[3]-t[2]*n[6],-t[0]*n[1]-t[1]*n[4]-t[2]*n[7],-t[0]*n[2]-t[1]*n[5]-t[2]*n[8],1]}const nO=(e,n)=>[n[0]*e[0]+n[1]*e[4]+n[2]*e[8]+n[3]*e[12],n[0]*e[1]+n[1]*e[5]+n[2]*e[9]+n[3]*e[13],n[0]*e[2]+n[1]*e[6]+n[2]*e[10]+n[3]*e[14],n[0]*e[3]+n[1]*e[7]+n[2]*e[11]+n[3]*e[15],n[4]*e[0]+n[5]*e[4]+n[6]*e[8]+n[7]*e[12],n[4]*e[1]+n[5]*e[5]+n[6]*e[9]+n[7]*e[13],n[4]*e[2]+n[5]*e[6]+n[6]*e[10]+n[7]*e[14],n[4]*e[3]+n[5]*e[7]+n[6]*e[11]+n[7]*e[15],n[8]*e[0]+n[9]*e[4]+n[10]*e[8]+n[11]*e[12],n[8]*e[1]+n[9]*e[5]+n[10]*e[9]+n[11]*e[13],n[8]*e[2]+n[9]*e[6]+n[10]*e[10]+n[11]*e[14],n[8]*e[3]+n[9]*e[7]+n[10]*e[11]+n[11]*e[15],n[12]*e[0]+n[13]*e[4]+n[14]*e[8]+n[15]*e[12],n[12]*e[1]+n[13]*e[5]+n[14]*e[9]+n[15]*e[13],n[12]*e[2]+n[13]*e[6]+n[14]*e[10]+n[15]*e[14],n[12]*e[3]+n[13]*e[7]+n[14]*e[11]+n[15]*e[15]];function nj(e){let n=e[0]*e[5]-e[1]*e[4],t=e[0]*e[6]-e[2]*e[4],o=e[0]*e[7]-e[3]*e[4],r=e[1]*e[6]-e[2]*e[5],i=e[1]*e[7]-e[3]*e[5],a=e[2]*e[7]-e[3]*e[6],s=e[8]*e[13]-e[9]*e[12],l=e[8]*e[14]-e[10]*e[12],c=e[8]*e[15]-e[11]*e[12],f=e[9]*e[14]-e[10]*e[13],d=e[9]*e[15]-e[11]*e[13],v=e[10]*e[15]-e[11]*e[14],u=n*v-t*d+o*f+r*c-i*l+a*s;return u?[(e[5]*v-e[6]*d+e[7]*f)/u,(e[2]*d-e[1]*v-e[3]*f)/u,(e[13]*a-e[14]*i+e[15]*r)/u,(e[10]*i-e[9]*a-e[11]*r)/u,(e[6]*c-e[4]*v-e[7]*l)/u,(e[0]*v-e[2]*c+e[3]*l)/u,(e[14]*o-e[12]*a-e[15]*t)/u,(e[8]*a-e[10]*o+e[11]*t)/u,(e[4]*d-e[5]*c+e[7]*s)/u,(e[1]*c-e[0]*d-e[3]*s)/u,(e[12]*i-e[13]*o+e[15]*n)/u,(e[9]*o-e[8]*i-e[11]*n)/u,(e[5]*l-e[4]*f-e[6]*s)/u,(e[0]*f-e[1]*l+e[2]*s)/u,(e[13]*t-e[12]*r-e[14]*n)/u,(e[8]*r-e[9]*t+e[10]*n)/u]:null}function nk(e,n,t,o,r){let i=Math.hypot(t,o,r),a=Math.sin(n),s=Math.cos(n),l=1-s,c=(t/=i)*t*l+s,f=(o/=i)*t*l+(r/=i)*a,d=r*t*l-o*a,v=t*o*l-r*a,u=o*o*l+s,x=r*o*l+t*a,m=t*r*l+o*a,p=o*r*l-t*a,y=r*r*l+s;return[e[0]*c+e[4]*f+e[8]*d,e[1]*c+e[5]*f+e[9]*d,e[2]*c+e[6]*f+e[10]*d,e[3]*c+e[7]*f+e[11]*d,e[0]*v+e[4]*u+e[8]*x,e[1]*v+e[5]*u+e[9]*x,e[2]*v+e[6]*u+e[10]*x,e[3]*v+e[7]*u+e[11]*x,e[0]*m+e[4]*p+e[8]*y,e[1]*m+e[5]*p+e[9]*y,e[2]*m+e[6]*p+e[10]*y,e[3]*m+e[7]*p+e[11]*y,...e.slice(12,16)]}const nD=(e,n,t,o)=>[...e.slice(0,12),e[0]*n+e[4]*t+e[8]*o+e[12],e[1]*n+e[5]*t+e[9]*o+e[13],e[2]*n+e[6]*t+e[10]*o+e[14],e[3]*n+e[7]*t+e[11]*o+e[15]],nU=[-1,.02,.07,0,.02,1,-.1,0,-.07,-.1,-.99,0,0,-.05,2.91,1],n$=document.documentElement,nR=n$.querySelector("canvas"),nC=n$.querySelector(".progress"),nF=n$.querySelector(".spinner"),nN=n$.querySelector(".fps"),nI=n$.querySelector(".cam"),nP=nA.get("background");nP&&(n$.style.background=nP);const nX="false"!==nA.get("wheel");let nV=nU;var nq={},nY={};nY=function(e,n,t){if(n===self.location.origin)return e;var o=t?"import "+JSON.stringify(e)+";":"importScripts("+JSON.stringify(e)+");";return URL.createObjectURL(new Blob([o],{type:"application/javascript"}))};let nH=new URL("worker.16797bd4.js",import.meta.url);async function nK(){let t,o,r,i,a,s,l,c,f,d,v="false"!==nA.get("carousel");try{nV=JSON.parse(decodeURIComponent(location.hash.slice(1))),v=!1}catch(e){}let u=new Worker(nq),x=!1,m=1,p=[],y=[],h=Object.assign(["epok.splat"],nA.getAll("m-url")).map(e=>new URL(e,location.href)),g=parseFloat(nA.get("models-on")||h.length,10),_=parseFloat(nA.get("models-at")||0,10),w=parseFloat(nA.get("models-loop")||1e-4,10),b=self.state={spread:parseFloat(nA.get("s-spread")||.01,10),offsets:parseFloat(nA.get("s-offsets")||4,10),velocity:JSON.parse(nA.get("s-velocity")||"[0, 1e-4, 0]"),speed:parseFloat(nA.get("s-speed")||.2,10),fade:parseFloat(nA.get("s-fade")||.6,10),scale:parseFloat(nA.get("s-scale")||1,10),curve:JSON.parse(nA.get("s-curve")||"[1, 1, 0]"),slide:parseFloat(nA.get("s-slide")||0,10)},z=new Uint8Array(0),A=(n,i=0)=>{let a=(p.indexOf(n)+1||p.push(n))-1,{data:s,size:l,translation:c=n.translation=[0,0,0],rotation:f=n.rotation=[0,0,0],scale:d=n.scale=[1,1,1]}=n;if(!s)return n.size=n.count=0,a;let v=c?.some(e=>e)||d?.some(e=>e&&1!==e)||f?.some(e=>e),{length:u,buffer:x}=s,m=n.count=Math.floor((l??u)/32);if(n.size=32*m,v){let[n,a,s]=f,[l,v,u]=d;!function(n,t="zyx",o,r,i){let[a,s,l]=n_[t];W(n,W(n,nw(n,a,o),nw(e??=[],s,r)),nw(e,l,i))}(o??=[],"zyx",s,a,n),en(t??=[],o,c),e8(t,e8(t,e8(t,t,l),v,4,4),u,8,8);for(let e=Math.floor(i/32);e<m;++e){let n=32*e;n+=4*J(null,t,new Float32Array(x,n,3)).length,n+=4*eQ(null,new Float32Array(x,n,3),d).length;let i=new Uint8ClampedArray(x,n,4),[a,s,l,c]=i;e3(r,nn(r,et(r??=[],s,l,c,a),-128),.0078125),W(r,o,r),[s,l,c,a]=nn(r,nd(r,r,128),128),et(i,a,s,l,c)}}return a},E=e=>u.postMessage({meta:y,buffer:z.buffer,vertexCount:Math.floor(z.length/32),freshData:e});function S(e,n,t){!function(e,n){y.fill(null,0,e).length=e;let t=p.length,o=y.reduce((e,o,r)=>e+((y[r]=p.at((n+r)%t))?.size??0),0);z.length!==o&&(z=new Uint8Array(o)),y.reduce((e,n)=>{let t=n?.data;if(!t)return e;let o=n.size,{length:r,buffer:i}=t;return z.set(o<r?new Uint8Array(i,0,o):t,e),e+o},0)}(e,n),E(t)}let L=nR.getContext("webgl2",{antialias:!1}),M=L.createShader(L.VERTEX_SHADER),T=`#version 300 es
#define maskMode ${nA.get("s-mode")||0}
`+("true"===nA.get("s-frag")?"#define maskFrag\n":"")+("false"!==nA.get("s-local")?"#define maskLocal\n":"")+("true"===nA.get("s-center")?"#define maskCenter\n":""),O=T+n(nb);L.shaderSource(M,O),L.compileShader(M),L.getShaderParameter(M,L.COMPILE_STATUS)||console.error(L.getShaderInfoLog(M),O);let j=L.createShader(L.FRAGMENT_SHADER),k=T+n(nz);L.shaderSource(j,k),L.compileShader(j),L.getShaderParameter(j,L.COMPILE_STATUS)||console.error(L.getShaderInfoLog(j),k);let D=L.createProgram();L.attachShader(D,M),L.attachShader(D,j),L.linkProgram(D),L.useProgram(D),L.getProgramParameter(D,L.LINK_STATUS)||console.error(L.getProgramInfoLog(D)),L.disable(L.DEPTH_TEST),L.enable(L.BLEND),L.blendFuncSeparate(L.ONE_MINUS_DST_ALPHA,L.ONE,L.ONE_MINUS_DST_ALPHA,L.ONE),L.blendEquationSeparate(L.FUNC_ADD,L.FUNC_ADD);let U=L.getUniformLocation(D,"viewport"),$=L.getUniformLocation(D,"projection"),R=L.getUniformLocation(D,"view"),C=L.getUniformLocation(D,"viewProjectionInverse"),F=L.getUniformLocation(D,"focal"),N=L.getUniformLocation(D,"splits"),I=L.getUniformLocation(D,"time"),P=L.getUniformLocation(D,"dt"),X=L.getUniformLocation(D,"spread"),V=L.getUniformLocation(D,"offsets"),q=L.getUniformLocation(D,"velocity"),Y=L.getUniformLocation(D,"speed"),H=L.getUniformLocation(D,"fade"),K=L.getUniformLocation(D,"scale"),G=L.getUniformLocation(D,"curve"),B=L.getUniformLocation(D,"slide"),Q=L.createTexture();L.bindTexture(L.TEXTURE_2D,Q);let Z=L.getUniformLocation(D,"texture");L.uniform1iv(Z,[0]);let ee=new Float32Array([-2,-2,2,-2,2,2,-2,2]),eo=L.createBuffer();L.bindBuffer(L.ARRAY_BUFFER,eo),L.bufferData(L.ARRAY_BUFFER,ee,L.STATIC_DRAW);let er=L.getAttribLocation(D,"position");L.enableVertexAttribArray(er),L.vertexAttribPointer(er,2,L.FLOAT,!1,0,0);let ei=L.createBuffer(),ea=L.getAttribLocation(D,"index");L.enableVertexAttribArray(ea),L.bindBuffer(L.ARRAY_BUFFER,ei),L.vertexAttribIPointer(ea,1,L.INT,!1,0,0),L.vertexAttribDivisor(ea,1);let es=()=>{L.uniform2fv(F,new Float32Array([nL.fx,nL.fy])),i=nM(nL.fx,nL.fy,innerWidth,innerHeight),L.uniform2fv(U,new Float32Array([innerWidth,innerHeight]));let e=nR.width=Math.round(innerWidth*m),n=nR.height=Math.round(innerHeight*m);L.viewport(0,0,e,n),L.uniformMatrix4fv($,!1,i)};window.addEventListener("resize",es),es(),u.onmessage=e=>{let{buffer:n,save:t,depthIndex:o,vertexCount:r,texdata:i,width:a,height:s,meta:l,freshData:c}=e.data;if(n){nE&&console.log("Update buffer",n.length);let e=new Uint8Array(n);if(t){A({data:e,...l}),S(g,_);let n=new Blob([e.buffer],{type:"application/octet-stream"}),t=document.createElement("a");t.download="model.splat",t.href=URL.createObjectURL(n),document.body.appendChild(t),t.click()}else z=e}else i?(nE&&console.log("Update texture",i.length),L.bindTexture(L.TEXTURE_2D,Q),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_S,L.CLAMP_TO_EDGE),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_T,L.CLAMP_TO_EDGE),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MIN_FILTER,L.NEAREST),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MAG_FILTER,L.NEAREST),L.texImage2D(L.TEXTURE_2D,0,L.RGBA32UI,a,s,0,L.RGBA_INTEGER,L.UNSIGNED_INT,i),L.activeTexture(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,Q),c&&w&&(b.slide=-Math.sign(w)*(g-1))):o&&(nE&&console.log("Update index",o.length,r),L.bindBuffer(L.ARRAY_BUFFER,ei),L.bufferData(L.ARRAY_BUFFER,o,L.DYNAMIC_DRAW),ew=r)};let el=[],ec=0;window.addEventListener("keydown",e=>{v=!1,el.includes(e.code)||el.push(e.code),/\d/.test(e.key)&&(nV=nT(nL=nS[ec=parseInt(e.key)])),["-","_"].includes(e.key)&&(ec=(ec+nS.length-1)%nS.length,nV=nT(nS[ec])),["+","="].includes(e.key)&&(ec=(ec+1)%nS.length,nV=nT(nS[ec])),"KeyV"===e.code?(location.hash="#"+JSON.stringify(nV,(e,n)=>Array.isArray(n)?n:Math.round(100*n)/100),nI.innerText="camera not set"):"KeyP"===e.code?(v=!0,nI.innerText="camera not set"):nI.innerText="camera "+ec}),window.addEventListener("keyup",e=>el=el.filter(n=>n!==e.code)),window.addEventListener("blur",()=>el=[]),nX&&window.addEventListener("wheel",e=>{v=!1,e.preventDefault();let n=1===e.deltaMode?10:2===e.deltaMode?innerHeight:1,t=nj(nV);e.shiftKey?t=nD(t,e.deltaX*n/innerWidth,e.deltaY*n/innerHeight,0):e.ctrlKey||e.metaKey?t=nD(t,0,0,-10*(e.deltaY*n)/innerHeight):(t=nk(t=nD(t,0,0,4),-(e.deltaX*n)/innerWidth,0,1,0),t=nD(t=nk(t,e.deltaY*n/innerHeight,1,0,0),0,0,-4)),nV=nj(t)},{passive:!1}),nR.addEventListener("mousedown",e=>{v=!1,e.preventDefault();let{ctrlKey:n,metaKey:t}=e;({clientX:s,clientY:l}=e),c=n||t?2:1}),nR.addEventListener("contextmenu",e=>{v=!1,e.preventDefault(),({clientX:s,clientY:l}=e),c=2}),nR.addEventListener("mousemove",e=>{if(e.preventDefault(),1==c){let n=nj(nV),t=5*(e.clientX-s)/innerWidth,o=5*(e.clientY-l)/innerHeight;n=nk(n=nD(n,0,0,4),t,0,1,0),nV=nj(n=nD(n=nk(n,-o,1,0,0),0,0,-4)),s=e.clientX,l=e.clientY}else if(2==c){let n=nj(nV);nV=nj(n=nD(n,-10*(e.clientX-s)/innerWidth,0,10*(e.clientY-l)/innerHeight)),s=e.clientX,l=e.clientY}}),nR.addEventListener("mouseup",e=>{e.preventDefault(),c=!1,s=l=0});let ef=0,ed=0;nR.addEventListener("touchstart",e=>{e.preventDefault();let[n,t]=e.touches;n&&(v=!1,c=1,{clientX:s,clientY:l}=n),t&&({clientX:ef,clientY:ed}=t)},{passive:!1}),nR.addEventListener("touchmove",e=>{let{touches:[n,t]}=e;if(e.preventDefault(),t){let e=Math.atan2(l-ed,s-ef)-Math.atan2(n.clientY-t.clientY,n.clientX-t.clientX),o=Math.hypot(s-ef,l-ed)/Math.hypot(n.clientX-t.clientX,n.clientY-t.clientY),r=(n.clientX+t.clientX-(s+ef))/2,i=(n.clientY+t.clientY-(l+ed))/2,a=nj(nV);a=nD(a=nk(a,e,0,0,1),-r/innerWidth,-i/innerHeight,0),nV=nj(a=nD(a,0,0,3*(1-o))),ef=t.clientX,ed=t.clientY}else if(c){let e=nj(nV),t=4*(n.clientX-s)/innerWidth,o=4*(n.clientY-l)/innerHeight;e=nk(e=nD(e,0,0,4),t,0,1,0),nV=nj(e=nD(e=nk(e,-o,1,0,0),0,0,-4))}s=n.clientX,l=n.clientY},{passive:!1}),nR.addEventListener("touchend",e=>{e.preventDefault(),c=!1,s=l=0},{passive:!1}),window.addEventListener("gamepadconnected",e=>{let n=navigator.getGamepads()[e.gamepad.index];nE&&console.log(`Gamepad connected at index ${n.index}: ${n.id}. It has ${n.buttons.length} buttons and ${n.axes.length} axes.`)}),window.addEventListener("gamepaddisconnected",e=>nE&&console.log("Gamepad disconnected"));let ev={mode:"cors",credentials:"omit",headers:{"Content-Type":"application/octet-stream"}},eu="true"===nA.get("stream"),ex=Object.assign([[1.93072,3.24839,-.736369]],nA.getAll("m-translate")).map(e=>e?Array.isArray(e)?e:JSON.parse(e):void 0),em=Object.assign([[-4.17982,-.031984,3.28073]],nA.getAll("m-rotate")).map(e=>e?Array.isArray(e)?e:JSON.parse(e):void 0),ep=Object.assign([[3.652,3.652,3.652]],nA.getAll("m-scale")).map(e=>e?Array.isArray(e)?e:JSON.parse(e):void 0),ey=[];async function eh(e){let n;let t=ey[e=nv(e,h.length)];if(nE&&console.log("Load model",e,x,t),x||t)return!x&&t;let o=ex[e],r=em[e],i=ep[e],a={data:null,translation:o,rotation:r,scale:i};A(a);let s=h[e],l=await fetch(s,ev),{status:c,url:f,body:d,headers:v}=l;if(nE&&console.log(l),200!==c)throw Error(c+" Unable to load "+f);if(x)return!1;let p=a.data=new Uint8Array(v.get("content-length"));p.length/32<5e5&&m!==(m=Math.max(m,devicePixelRatio))&&es(),nE&&console.log("Fetched data",p.length/32,m);let y=d.getReader(),w=0,b=0;function z(){a.size=b,A(a,+eu&&w),S(g,_)}for(let{done:e,value:t}=await y.read();!x&&!e;{done:e,value:t}=await y.read())p.set(t,w=b),b+=t.length,eu&&w!==b&&!1===(n??=eL(p,b))&&z();return nE&&console.log("Loaded data",p.length/32),!x&&((n??=eL(p))?u.postMessage({ply:p.buffer,save:!1,meta:{translation:o,rotation:r,scale:i}}):z(),ey[e]=a)}let eg=()=>Promise.all(Array(g).fill().reduce((e,n,t,o)=>(o[t]=eh(_+t))&&o,null));eg();let e_=0,ew=0,eb=0,ez=0,eA=Date.now(),eE=0,eS=e=>{let n=nj(nV),t=el.includes("Shift")||el.includes("ShiftLeft")||el.includes("ShiftRight");el.includes("ArrowUp")&&(n=t?nD(n,0,-.03,0):nD(n,0,0,.1)),el.includes("ArrowDown")&&(n=t?nD(n,0,.03,0):nD(n,0,0,-.1)),el.includes("ArrowLeft")&&(n=nD(n,-.03,0,0)),el.includes("ArrowRight")&&(n=nD(n,.03,0,0)),el.includes("KeyA")&&(n=nk(n,-.01,0,1,0)),el.includes("KeyD")&&(n=nk(n,.01,0,1,0)),el.includes("KeyQ")&&(n=nk(n,.01,0,0,1)),el.includes("KeyE")&&(n=nk(n,-.01,0,0,1)),el.includes("KeyW")&&(n=nk(n,.005,1,0,0)),el.includes("KeyS")&&(n=nk(n,-.005,1,0,0));let o=navigator.getGamepads?navigator.getGamepads():[],r=el.includes("Space");for(let e of o){if(!e)continue;Math.abs(e.axes[0])>.1&&(n=nD(n,.06*e.axes[0],0,0),v=!1),Math.abs(e.axes[1])>.1&&(n=nD(n,0,0,-.06*e.axes[1]),v=!1),(e.buttons[12].pressed||e.buttons[13].pressed)&&(n=nD(n,0,-.06*(e.buttons[12].pressed-e.buttons[13].pressed),0),v=!1),(e.buttons[14].pressed||e.buttons[15].pressed)&&(n=nD(n,-.06*(e.buttons[14].pressed-e.buttons[15].pressed),0,0),v=!1),Math.abs(e.axes[2])>.1&&(n=nk(n,.02*e.axes[2],0,1,0),v=!1),Math.abs(e.axes[3])>.1&&(n=nk(n,-.02*e.axes[3],1,0,0),v=!1);let t=e.buttons[6].value-e.buttons[7].value;Math.abs(t)>.1&&(n=nk(n,.02*t,0,0,1),v=!1),e.buttons[4].pressed&&!f&&(n=nj(nT(nL=nS[(nS.indexOf(nL)+1)%nS.length])),v=!1),e.buttons[5].pressed&&!d&&(n=nj(nT(nL=nS[(nS.indexOf(nL)+nS.length-1)%nS.length])),v=!1),f=e.buttons[4].pressed,d=e.buttons[5].pressed,e.buttons[0].pressed&&(r=!0,v=!1),e.buttons[3].pressed&&(v=!0)}["KeyJ","KeyK","KeyL","KeyI"].some(e=>el.includes(e))&&(n=nk(n=nD(n,0,0,4),el.includes("KeyJ")?-.05:.05*!!el.includes("KeyL"),0,1,0),n=nD(n=nk(n,el.includes("KeyI")?.05:el.includes("KeyK")?-.05:0,1,0,0),0,0,-4)),nV=nj(n);let s=eE,l=(eE=Date.now()-eA)-s;if(L.uniform1f(I,eE),L.uniform1f(P,l),L.uniform1f(N,y.length),w){let e=Math.sign(w),n=(g-1)*e;b.slide*e<=n&&(b.slide+=w*l)*e>n&&(_+=n,eg().then(()=>S(g,_,!0)))}let{spread:c,offsets:x,velocity:m,speed:p,fade:h,scale:A,curve:E,slide:M}=b;if(L.uniform1f(X,c),L.uniform1f(V,x),L.uniform3fv(q,m),L.uniform1f(Y,p),L.uniform1f(H,h),L.uniform1f(K,A),L.uniform3fv(G,E),L.uniform1f(B,M),v){let e=nj(nU),n=Math.sin(eE/5e3);nV=nj(e=nk(e=nD(e,2*n,.2*(1-Math.cos(n)),2.5*(1-Math.cos(n))),-.6*n,0,1,0))}e_=r?Math.min(1,e_+.05):Math.max(0,e_-.05);let T=nj(nV),O=nj(T=nk(T=nD(T,0,-e_,0),-.1*e_,1,0,0));a=nO(i,O),u.postMessage({viewProjection:a}),ez=.9*ez+.1*(1e3/(e-eb)||0),ew>0?(L.uniformMatrix4fv(C,!1,nj(a)),L.uniformMatrix4fv(R,!1,O),L.clear(L.COLOR_BUFFER_BIT),L.drawArraysInstanced(L.TRIANGLE_FAN,0,4,ew),nF.style.display="none"):(L.clear(L.COLOR_BUFFER_BIT),nF.style.display="",eA=Date.now());let j=ew/(z.length/32);nC.style.transform=`scaleX(${j})`,nC.style.display=j<1?"":"none",nN.innerText=(Number.isFinite(ez)?Math.round(ez):"unknown")+" fps",nI.innerText="camera "+(isNaN(ec)?"not set":ec),eb=e,requestAnimationFrame(eS)};eS();let eL=(()=>{let e="ply\n".split("").map(e=>e.charCodeAt(0));return(n,t=4)=>t<4?null:e.every((e,t)=>e===n[t])})(),eM=e=>{let n=new FileReader;/\.json$/i.test(e.name)?(n.onload=()=>{nV=nT((nS=JSON.parse(n.result))[0]),i=nM(nL.fx,nL.fy,nR.width,nR.height),L.uniformMatrix4fv($,!1,i),nE&&console.log("Loaded Cameras")},n.readAsText(e)):(x=!0,n.onload=()=>{let e=new Uint8Array(n.result);nE&&console.log("Loaded",Math.floor(e.length/32)),eL(e)?u.postMessage({ply:e.buffer,save:!0}):(A({data:e}),S(g,_))},n.readAsArrayBuffer(e))};window.addEventListener("hashchange",e=>{try{nV=JSON.parse(decodeURIComponent(location.hash.slice(1))),v=!1}catch(e){}});let eT=e=>{e.preventDefault(),e.stopPropagation()};document.addEventListener("dragenter",eT),document.addEventListener("dragover",eT),document.addEventListener("dragleave",eT),document.addEventListener("drop",e=>{e.preventDefault(),e.stopPropagation(),eM(e.dataTransfer.files[0])})}nq=nY(nH.toString(),nH.origin,!0),(async()=>{try{await nK()}catch(e){nF.style.color="red",console.error(e)}})();